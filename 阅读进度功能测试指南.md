# ğŸ“– é˜…è¯»è¿›åº¦åŠŸèƒ½æµ‹è¯•æŒ‡å—

## ğŸ‰ æ•°æ®åº“æƒé™é…ç½®æˆåŠŸï¼

ä¸¤ä¸ªé›†åˆçš„æƒé™éƒ½å·²æ­£ç¡®é…ç½®ï¼š
- âœ… `reading_progress` - ä»…åˆ›å»ºè€…å¯è¯»å†™
- âœ… `user_shelf` - ä»…åˆ›å»ºè€…å¯è¯»å†™

ç°åœ¨å¯ä»¥æµ‹è¯•å®Œæ•´çš„é˜…è¯»ä½“éªŒäº†ï¼

---

## ğŸ§ª å®Œæ•´åŠŸèƒ½æµ‹è¯•æµç¨‹

### æµ‹è¯•1ï¼šé¦–æ¬¡é˜…è¯»ä¹¦ç±

1. **æ‰“å¼€ä¹¦æ¶é¡µé¢**
   ```javascript
   wx.navigateTo({ url: '/pages/novel/shelf/shelf' })
   ```

2. **ç‚¹å‡»ã€Šä¸­åœºä¸»å®°-æƒŠè‰³ä¸€è„šã€‹**
   - åº”è¯¥ç«‹å³æ‰“å¼€é˜…è¯»å™¨ï¼ˆ< 1ç§’ï¼‰
   - ä»ç¬¬1é¡µå¼€å§‹æ˜¾ç¤º

3. **ç¿»å‡ é¡µ**
   - å‘å·¦æ»‘åŠ¨ç¿»é¡µ
   - è§‚å¯Ÿé¡µç å˜åŒ–

4. **å…³é—­é˜…è¯»é¡µé¢**ï¼ˆè¿”å›æŒ‰é’®ï¼‰

### æµ‹è¯•2ï¼šè¿›åº¦ä¿å­˜éªŒè¯

5. **æŸ¥çœ‹ä¿å­˜çš„è¿›åº¦**
   åœ¨æ§åˆ¶å°è¿è¡Œï¼š
   ```javascript
   wx.cloud.database().collection('reading_progress')
     .get()
     .then(res => {
       console.log('ğŸ“š æˆ‘çš„é˜…è¯»è¿›åº¦:')
       res.data.forEach(p => {
         console.log(`  ğŸ“– ${p.novelTitle}`)
         console.log(`     å½“å‰é¡µç : ç¬¬ ${p.currentPage + 1} é¡µ`)
         console.log(`     æœ€åé˜…è¯»: ${new Date(p.lastReadTime).toLocaleString()}`)
         console.log(`     é˜…è¯»è¿›åº¦: ${p.progressPercent}%`)
       })
     })
   ```

   **æœŸæœ›çœ‹åˆ°ï¼š**
   ```
   ğŸ“š æˆ‘çš„é˜…è¯»è¿›åº¦:
     ğŸ“– ä¸­åœºä¸»å®°-æƒŠè‰³ä¸€è„š
        å½“å‰é¡µç : ç¬¬ X é¡µï¼ˆä½ åˆšæ‰ç¿»åˆ°çš„é¡µç ï¼‰
        æœ€åé˜…è¯»: 2025/11/23 ...
        é˜…è¯»è¿›åº¦: X.XX%
   ```

### æµ‹è¯•3ï¼šæ–­ç‚¹ç»­è¯»

6. **é‡æ–°æ‰“å¼€ä¹¦ç±**
   - å†æ¬¡ç‚¹å‡»ã€Šä¸­åœºä¸»å®°-æƒŠè‰³ä¸€è„šã€‹
   - **åº”è¯¥è‡ªåŠ¨å®šä½åˆ°ä¸Šæ¬¡çš„ä½ç½®**
   - é¡µç åº”è¯¥æ˜¯ä½ ä¸Šæ¬¡çœ‹åˆ°çš„é¡µç 

7. **æ§åˆ¶å°åº”è¯¥æ˜¾ç¤ºï¼š**
   ```
   âœ… åŠ è½½è¿›åº¦æˆåŠŸ: ç¬¬Xé¡µ
   ```
   è€Œä¸æ˜¯ä¹‹å‰çš„ï¼š
   ```
   âš ï¸ æ— æ³•åŠ è½½è¿›åº¦: Permission denied
   ```

### æµ‹è¯•4ï¼šä¹¦æ¶è‡ªåŠ¨æ·»åŠ 

8. **æŸ¥çœ‹ä¹¦æ¶æ•°æ®**
   ```javascript
   wx.cloud.database().collection('user_shelf')
     .get()
     .then(res => {
       console.log('ğŸ“š æˆ‘çš„ä¹¦æ¶:', res.data.length, 'æœ¬ä¹¦')
       res.data.forEach(book => {
         console.log(`  ğŸ“– ${book.novelTitle}`)
         console.log(`     åŠ å…¥æ—¶é—´: ${new Date(book.addTime).toLocaleString()}`)
       })
     })
   ```

   **æœŸæœ›çœ‹åˆ°ï¼š**
   ```
   ğŸ“š æˆ‘çš„ä¹¦æ¶: 1 æœ¬ä¹¦
     ğŸ“– ä¸­åœºä¸»å®°-æƒŠè‰³ä¸€è„š
        åŠ å…¥æ—¶é—´: 2025/11/23 ...
   ```

### æµ‹è¯•5ï¼šè·¨é¡µé˜…è¯»

9. **ç»§ç»­ç¿»é¡µé˜…è¯»**
   - ç¿»åŠ¨20-30é¡µ
   - å…³é—­é˜…è¯»å™¨

10. **å†æ¬¡æ‰“å¼€**
    - åº”è¯¥å‡†ç¡®å®šä½åˆ°æœ€æ–°ä½ç½®
    - éªŒè¯é¡µç æ­£ç¡®

---

## ğŸ” è°ƒè¯•ä¿¡æ¯æ£€æŸ¥

å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œæ§åˆ¶å°åº”è¯¥æ˜¾ç¤ºï¼š

### æ‰“å¼€ä¹¦ç±æ—¶ï¼š
```
ğŸ“– å¼€å§‹åŠ è½½å°è¯´: ä¸­åœºä¸»å®°-æƒŠè‰³ä¸€è„š
âœ… å°è¯´ä¿¡æ¯åŠ è½½æˆåŠŸ
âœ… åŠ è½½è¿›åº¦æˆåŠŸ: ç¬¬Xé¡µ
ğŸ“„ åŠ è½½åˆ†æ®µ: 0 (é¡µç èŒƒå›´: 0-99)
âœ… åˆ†æ®µåŠ è½½æˆåŠŸ
```

### ç¿»é¡µæ—¶ï¼ˆæ¯éš”5é¡µä¿å­˜ä¸€æ¬¡ï¼‰ï¼š
```
ğŸ’¾ ä¿å­˜è¿›åº¦: ç¬¬Xé¡µ
âœ… è¿›åº¦ä¿å­˜æˆåŠŸ
```

### ä¸åº”è¯¥å†çœ‹åˆ°çš„é”™è¯¯ï¼š
```
âŒ æ— æ³•åŠ è½½è¿›åº¦: Permission denied
âŒ ä¿å­˜è¿›åº¦å¤±è´¥: Permission denied
âŒ åŠ å…¥ä¹¦æ¶å¤±è´¥: Permission denied
```

---

## ğŸ§¹ æ¸…ç†æµ‹è¯•æ•°æ®ï¼ˆå¯é€‰ï¼‰

å¦‚æœä¹‹å‰çš„æµ‹è¯•åˆ›å»ºäº†å¾ˆå¤šæ— ç”¨æ•°æ®ï¼Œå¯ä»¥æ¸…ç†ï¼š

```javascript
// æ¸…ç†æµ‹è¯•æ•°æ®ï¼ˆåªåˆ é™¤ test å­—æ®µçš„è®°å½•ï¼‰
const cleanTestData = async () => {
  const db = wx.cloud.database()
  
  // æ¸…ç† reading_progress
  const progress = await db.collection('reading_progress')
    .where({ test: db.command.exists(true) })
    .get()
  
  for (let item of progress.data) {
    await db.collection('reading_progress').doc(item._id).remove()
  }
  console.log(`âœ… æ¸…ç†äº† ${progress.data.length} æ¡ reading_progress æµ‹è¯•æ•°æ®`)
  
  // æ¸…ç† user_shelf
  const shelf = await db.collection('user_shelf')
    .where({ test: db.command.exists(true) })
    .get()
  
  for (let item of shelf.data) {
    await db.collection('user_shelf').doc(item._id).remove()
  }
  console.log(`âœ… æ¸…ç†äº† ${shelf.data.length} æ¡ user_shelf æµ‹è¯•æ•°æ®`)
  
  console.log('ğŸ‰ æµ‹è¯•æ•°æ®æ¸…ç†å®Œæˆï¼')
}

cleanTestData()
```

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®

æ§åˆ¶å°æ˜¾ç¤ºäº†æ•°æ®åº“ç´¢å¼•å»ºè®®ã€‚è™½ç„¶ç°åœ¨æ•°æ®é‡å°ä¸å½±å“ï¼Œä½†å¦‚æœä»¥åç”¨æˆ·å¢å¤šï¼Œå¯ä»¥è€ƒè™‘å»ºç«‹ç´¢å¼•ï¼š

### reading_progress ç´¢å¼•
```javascript
// åœ¨äº‘å¼€å‘æ§åˆ¶å° â†’ æ•°æ®åº“ â†’ reading_progress â†’ ç´¢å¼•
// åˆ›å»ºç»„åˆç´¢å¼•ï¼š
{
  "novelId": 1,    // å‡åº
  "_openid": 1     // å‡åº
}
```

### user_shelf ç´¢å¼•
```javascript
// åœ¨äº‘å¼€å‘æ§åˆ¶å° â†’ æ•°æ®åº“ â†’ user_shelf â†’ ç´¢å¼•
// åˆ›å»ºç»„åˆç´¢å¼•ï¼š
{
  "novelId": 1,    // å‡åº
  "_openid": 1     // å‡åº
}
```

**ä½†ç°åœ¨ä¸ç”¨åˆ›å»ºï¼Œç­‰ä»¥åçœŸçš„éœ€è¦æ—¶å†åˆ›å»ºã€‚**

---

## ğŸ¯ æˆåŠŸæ ‡å‡†

å¦‚æœä»¥ä¸‹æ‰€æœ‰æ¡ä»¶éƒ½æ»¡è¶³ï¼Œè¯´æ˜ç³»ç»Ÿå®Œå…¨æ­£å¸¸ï¼š

- âœ… æ‰“å¼€ä¹¦ç±é€Ÿåº¦å¿«ï¼ˆ< 1ç§’ï¼‰
- âœ… ç¿»é¡µæµç•…
- âœ… å…³é—­åé‡æ–°æ‰“å¼€èƒ½å®šä½åˆ°ä¸Šæ¬¡ä½ç½®
- âœ… æ§åˆ¶å°æ²¡æœ‰ Permission denied é”™è¯¯
- âœ… `reading_progress` é›†åˆæœ‰æ­£ç¡®çš„è¿›åº¦è®°å½•
- âœ… `user_shelf` é›†åˆæœ‰ä¹¦ç±è®°å½•

---

## ğŸŠ æ­å–œï¼

ä½ çš„å°è¯´ç³»ç»Ÿç°åœ¨å®Œå…¨å¯ç”¨äº†ï¼

### ç³»ç»Ÿç‰¹æ€§ï¼š
1. âœ… **å¿«é€Ÿä¸Šä¼ **ï¼šç®¡ç†å‘˜å¯ä»¥ç›´æ¥ä¸Šä¼  txt æ–‡ä»¶
2. âœ… **å³æ—¶é˜…è¯»**ï¼šæ‰“å¼€ä¹¦ç±ç«‹å³æ˜¾ç¤ºï¼ˆä¸éœ€è¦è§£æï¼‰
3. âœ… **æ¨ªå‘ç¿»é¡µ**ï¼šæµç•…çš„å·¦å³æ»‘åŠ¨ç¿»é¡µ
4. âœ… **è¿›åº¦ä¿å­˜**ï¼šè‡ªåŠ¨ä¿å­˜é˜…è¯»ä½ç½®
5. âœ… **æ–­ç‚¹ç»­è¯»**ï¼šé‡æ–°æ‰“å¼€è‡ªåŠ¨å®šä½
6. âœ… **ä¹¦æ¶ç®¡ç†**ï¼šé˜…è¯»è¿‡çš„ä¹¦è‡ªåŠ¨åŠ å…¥ä¹¦æ¶
7. âœ… **æƒé™éš”ç¦»**ï¼šæ¯ä¸ªç”¨æˆ·åªèƒ½çœ‹åˆ°è‡ªå·±çš„è¿›åº¦

### ä¸æ—§ç³»ç»Ÿå¯¹æ¯”ï¼š
| åŠŸèƒ½ | æ—§ç³»ç»Ÿï¼ˆparseNovelï¼‰ | æ–°ç³»ç»Ÿï¼ˆreader-v2ï¼‰ |
|-----|-------------------|-------------------|
| æ‰“å¼€é€Ÿåº¦ | 20ç§’+ è¶…æ—¶ âŒ | < 1ç§’ âœ… |
| é˜…è¯»æ–¹å¼ | å‚ç›´æ»šåŠ¨ | æ¨ªå‘ç¿»é¡µ âœ… |
| è¿›åº¦ä¿å­˜ | ç« èŠ‚ç¼–å· | ç²¾ç¡®åˆ°é¡µç  âœ… |
| ç”¨æˆ·ä½“éªŒ | éœ€è¦ç­‰å¾… | å³å¼€å³è¯» âœ… |
| æƒé™ç®¡ç† | ç®€å• | å®Œæ•´éš”ç¦» âœ… |

---

**ç°åœ¨å»å°ç¨‹åºé‡Œä½“éªŒä¸€ä¸‹å§ï¼äº«å—æµç•…çš„é˜…è¯»ä½“éªŒï¼** ğŸ“–âœ¨
