<!-- pages/european_standings/european_standings.wxml -->
<bg src="{{bgImageUrl}}" overlayOpacity="0.4" blur="0" sizeMode="cover" repeat="false" />

<view class="container">
  <!-- æ ‡é¢˜åŒºåŸŸ -->
  <view class="header">
    <text class="title">ğŸŒ æ¬§æ´²äº”å¤§è”èµ›ç§¯åˆ†æ¦œ</text>
    <text class="subtitle">2025-2026èµ›å­£</text>
  </view>

  <!-- è”èµ›åˆ‡æ¢æ ‡ç­¾ -->
  <view class="league-tabs">
    <view 
      class="tab-item {{currentLeague === 'PL' ? 'active pl' : ''}}" 
      bindtap="switchLeague" 
      data-league="PL"
    >
      <text class="tab-text">è‹±è¶…</text>
    </view>
    <view 
      class="tab-item {{currentLeague === 'PD' ? 'active pd' : ''}}" 
      bindtap="switchLeague" 
      data-league="PD"
    >
      <text class="tab-text">è¥¿ç”²</text>
    </view>
    <view 
      class="tab-item {{currentLeague === 'BL1' ? 'active bl1' : ''}}" 
      bindtap="switchLeague" 
      data-league="BL1"
    >
      <text class="tab-text">å¾·ç”²</text>
    </view>
    <view 
      class="tab-item {{currentLeague === 'FL1' ? 'active fl1' : ''}}" 
      bindtap="switchLeague" 
      data-league="FL1"
    >
      <text class="tab-text">æ³•ç”²</text>
    </view>
    <view 
      class="tab-item {{currentLeague === 'SA' ? 'active sa' : ''}}" 
      bindtap="switchLeague" 
      data-league="SA"
    >
      <text class="tab-text">æ„ç”²</text>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-container">
    <text class="loading-text">âš½ æ­£åœ¨åŠ è½½{{leagueName}}ç§¯åˆ†æ¦œ...</text>
  </view>

  <!-- é”™è¯¯æç¤º -->
  <view wx:elif="{{error}}" class="error-container">
    <text class="error-text">âŒ {{error}}</text>
    <button class="retry-button" bindtap="loadStandings">é‡æ–°åŠ è½½</button>
  </view>

  <!-- ç§¯åˆ†æ¦œåˆ—è¡¨ -->
  <view wx:else class="standings-list">
    <!-- è¡¨å¤´ -->
    <view class="standings-header">
      <text class="col-rank">æ’å</text>
      <text class="col-team">çƒé˜Ÿ</text>
      <text class="col-played">èµ›</text>
      <text class="col-record">èƒœ/å¹³/è´Ÿ</text>
      <text class="col-gd">å‡€èƒœçƒ</text>
      <text class="col-points">ç§¯åˆ†</text>
    </view>

    <!-- çƒé˜Ÿåˆ—è¡¨ -->
    <view class="standings-row" 
          wx:for="{{standings}}" 
          wx:key="position">
      <text class="col-rank {{item.rankClass}}">{{item.position}}</text>
      <view class="col-team team-info">
        <image wx:if="{{item.team.crest}}" class="team-logo" src="{{item.team.crest}}" mode="aspectFit"></image>
  <text class="team-name" bindtap="showSquad" data-team-id="{{item.team.id}}" data-team-name="{{item.team.shortName || item.team.name}}">{{item.team.shortName || item.team.name}}</text>
      </view>
      <text class="col-played">{{item.playedGames}}</text>
      <view class="col-record record-wrapper">
        <text class="record-win">{{item.won}}</text>
        <text class="record-separator">/</text>
        <text class="record-draw">{{item.draw}}</text>
        <text class="record-separator">/</text>
        <text class="record-lost">{{item.lost}}</text>
      </view>
      <text class="col-gd {{item.goalDifference > 0 ? 'gd-positive' : item.goalDifference < 0 ? 'gd-negative' : 'gd-zero'}}">{{item.goalDifference > 0 ? '+' : ''}}{{item.goalDifference}}</text>
      <text class="col-points points">{{item.points}}</text>
    </view>
  </view>

  <!-- å›¾ä¾‹è¯´æ˜ -->
  <view wx:if="{{!loading && !error && standings.length > 0}}" class="legend">
    <view class="legend-item">
      <view class="legend-color champion"></view>
      <text class="legend-text">æ¬§å† </text>
    </view>
    <view class="legend-item">
      <view class="legend-color europa"></view>
      <text class="legend-text">æ¬§è”</text>
    </view>
    <view class="legend-item">
      <view class="legend-color relegation"></view>
      <text class="legend-text">é™çº§</text>
    </view>
  </view>

  <!-- æ›´æ–°æ—¶é—´ -->
  <view wx:if="{{!loading && !error && standings.length > 0}}" class="update-time">
    <text>æ•°æ®æ›´æ–°äº: {{updateTime}}</text>
  </view>
</view>

<!-- é˜µå®¹å¼¹çª— -->
<view class="squad-modal" wx:if="{{showSquadModal}}" catchtap="closeSquadModal">
  <view class="squad-modal-content" catchtap="stopPropagation">
    <!-- å¼¹çª—å¤´éƒ¨ -->
    <view class="squad-header">
      <image wx:if="{{currentTeam.crest}}" class="squad-team-logo" src="{{currentTeam.crest}}" mode="aspectFit"></image>
      <view class="squad-header-text">
        <text class="squad-team-name">{{currentTeam.name}}</text>
        <text class="squad-count">é˜µå®¹ {{squadPlayers.length}} äºº</text>
      </view>
      <view class="close-btn" catchtap="closeSquadModal">âœ•</view>
    </view>

    <!-- é˜µå®¹åˆ†ç»„ -->
    <scroll-view class="squad-body" scroll-y>
      <!-- å‰é”‹ -->
      <view class="position-group" wx:if="{{squadByPosition.attackers.length > 0}}">
        <view class="position-title">
          <text class="position-icon">âš¡</text>
          <text class="position-name">å‰é”‹ ({{squadByPosition.attackers.length}})</text>
        </view>
        <view class="player-list">
          <view class="player-item" wx:for="{{squadByPosition.attackers}}" wx:key="id">
            <view class="player-number">{{item.shirtNumber || '-'}}</view>
            <view class="player-info">
              <text class="player-name">{{item.name}}</text>
              <text class="player-stats">å‡ºåœº: {{item.appearances || 0}} | è¿›çƒ: {{item.goals || 0}} | åŠ©æ”»: {{item.assists || 0}}</text>
            </view>
            <view wx:if="{{item.injured}}" class="injury-badge">ğŸ¤• ä¼¤</view>
          </view>
        </view>
      </view>

      <!-- ä¸­åœº -->
      <view class="position-group" wx:if="{{squadByPosition.midfielders.length > 0}}">
        <view class="position-title">
          <text class="position-icon">âš½</text>
          <text class="position-name">ä¸­åœº ({{squadByPosition.midfielders.length}})</text>
        </view>
        <view class="player-list">
          <view class="player-item" wx:for="{{squadByPosition.midfielders}}" wx:key="id">
            <view class="player-number">{{item.shirtNumber || '-'}}</view>
            <view class="player-info">
              <text class="player-name">{{item.name}}</text>
              <text class="player-stats">å‡ºåœº: {{item.appearances || 0}} | è¿›çƒ: {{item.goals || 0}} | åŠ©æ”»: {{item.assists || 0}}</text>
            </view>
            <view wx:if="{{item.injured}}" class="injury-badge">ğŸ¤• ä¼¤</view>
          </view>
        </view>
      </view>

      <!-- åå« -->
      <view class="position-group" wx:if="{{squadByPosition.defenders.length > 0}}">
        <view class="position-title">
          <text class="position-icon">ğŸ›¡ï¸</text>
          <text class="position-name">åå« ({{squadByPosition.defenders.length}})</text>
        </view>
        <view class="player-list">
          <view class="player-item" wx:for="{{squadByPosition.defenders}}" wx:key="id">
            <view class="player-number">{{item.shirtNumber || '-'}}</view>
            <view class="player-info">
              <text class="player-name">{{item.name}}</text>
              <text class="player-stats">å‡ºåœº: {{item.appearances || 0}} | è¿›çƒ: {{item.goals || 0}} | åŠ©æ”»: {{item.assists || 0}}</text>
            </view>
            <view wx:if="{{item.injured}}" class="injury-badge">ğŸ¤• ä¼¤</view>
          </view>
        </view>
      </view>

      <!-- é—¨å°† -->
      <view class="position-group" wx:if="{{squadByPosition.goalkeepers.length > 0}}">
        <view class="position-title">
          <text class="position-icon">ğŸ§¤</text>
          <text class="position-name">é—¨å°† ({{squadByPosition.goalkeepers.length}})</text>
        </view>
        <view class="player-list">
          <view class="player-item" wx:for="{{squadByPosition.goalkeepers}}" wx:key="id">
            <view class="player-number">{{item.shirtNumber || '-'}}</view>
            <view class="player-info">
              <text class="player-name">{{item.name}}</text>
              <text class="player-stats">å‡ºåœº: {{item.appearances || 0}} | é›¶å°: {{item.cleanSheets || 0}}</text>
            </view>
            <view wx:if="{{item.injured}}" class="injury-badge">ğŸ¤• ä¼¤</view>
          </view>
        </view>
      </view>
    </scroll-view>
  </view>
</view>
