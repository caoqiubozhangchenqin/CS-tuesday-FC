<!-- pages/novel/reader/reader.wxml --><!-- pages/novel/reader/reader.wxml --><!-- pages/novel/reader/reader.wxml -->

<view class="container {{themeClass}}">

  <!-- å·¦ä¾§æ‚¬æµ®èœå•æŒ‰é’® --><view class="container {{themeClass}}"><view class="c      <!-- ç« èŠ‚åº•éƒ¨æç¤º - ä½¿ç”¨èœå•åˆ‡æ¢ç« èŠ‚ -->

  <view class="floating-menu-btn" bindtap="toggleMenu">

    <text class="menu-icon">â˜°</text>  <!-- å·¦ä¾§æ‚¬æµ®èœå•æŒ‰é’® -->      <view wx:if="{{!isLoading && chapterContent && currentChapterIndex < totalChapters - 1}}" class="chapter-end-hint">

  </view>

  <view class="floating-menu-btn" bindtap="toggleMenu">        <view class="hint-btn" bindtap="nextChapter">

  <!-- é¡¶éƒ¨æ ‡é¢˜æ ï¼ˆç®€åŒ–ç‰ˆï¼Œåªæ˜¾ç¤ºä¹¦åï¼‰-->

  <view class="header" wx:if="{{showHeader}}">    <text class="menu-icon">â˜°</text>          <text>ğŸ‘‰ ä¸‹ä¸€ç« </text>

    <view class="header-center">

      <text class="book-title">{{bookName}}</text>  </view>        </view>

    </view>

  </view>      </view>{{themeClass}}">



  <!-- ç« èŠ‚å†…å®¹ï¼ˆæ»šåŠ¨æ¨¡å¼ï¼‰-->  <!-- é¡¶éƒ¨æ ‡é¢˜æ ï¼ˆç®€åŒ–ç‰ˆï¼Œåªæ˜¾ç¤ºä¹¦åï¼‰-->  <!-- å·¦ä¾§æ‚¬æµ®èœå•æŒ‰é’® -->

  <scroll-view 

    class="content-scroll"   <view class="header" wx:if="{{showHeader}}">  <view class="floating-menu-btn" bindtap="toggleMenu">

    scroll-y="{{true}}"

    bindtap="toggleHeader"    <view class="header-center">    <text class="menu-icon">â˜°</text>

    scroll-top="{{scrollTop}}"

    bindscroll="onScroll"      <text class="book-title">{{bookName}}</text>  </view>

    refresher-enabled="{{true}}"

    refresher-threshold="80"    </view>

    refresher-triggered="{{pullDownRefreshing}}"

    bindrefresherrefresh="onPullDownRefresh"  </view>  <!-- é¡¶éƒ¨æ ‡é¢˜æ ï¼ˆç®€åŒ–ç‰ˆï¼Œåªæ˜¾ç¤ºä¹¦åï¼‰-->

  >

    <view class="content-container">  <view class="header" wx:if="{{showHeader}}">

      <!-- ç¬¬ä¸€ç« æç¤º -->

      <view wx:if="{{!isLoading && chapterContent && currentChapterIndex === 0}}" class="start-hint">  <!-- ç« èŠ‚å†…å®¹ï¼ˆæ»šåŠ¨æ¨¡å¼ï¼‰-->    <view class="header-center">

        <text>ğŸ“– è¿™æ˜¯ç¬¬ä¸€ç« </text>

      </view>  <scroll-view       <text class="book-title">{{bookName}}</text>



      <!-- ç« èŠ‚æ ‡é¢˜ -->    class="content-scroll"     </view>

      <view class="chapter-title">{{chapterTitle}}</view>

          scroll-y="{{true}}"  </view>

      <!-- åŠ è½½çŠ¶æ€ -->

      <view wx:if="{{isLoading}}" class="loading-state">    bindtap="toggleHeader"

        <text class="loading-icon">ğŸ“–</text>

        <text class="loading-text">åŠ è½½ä¸­...</text>    scroll-top="{{scrollTop}}"  <!-- ç« èŠ‚å†…å®¹ï¼ˆæ»šåŠ¨æ¨¡å¼ï¼‰-->

      </view>

    bindscroll="onScroll"  <scroll-view 

      <!-- ç« èŠ‚å†…å®¹ -->

      <view wx:if="{{!isLoading && chapterContent}}" class="chapter-content" style="font-size: {{fontSize}}px;">    refresher-enabled="{{true}}"    class="content-scroll" 

        <text class="content-text" decode="{{true}}" space="{{true}}">{{chapterContent}}</text>

      </view>    refresher-threshold="80"    scroll-y="{{true}}"



      <!-- åŠ è½½å¤±è´¥ -->    refresher-triggered="{{pullDownRefreshing}}"    bindtap="toggleHeader"

      <view wx:if="{{!isLoading && !chapterContent}}" class="error-state">

        <text class="error-icon">ğŸ˜”</text>    bindrefresherrefresh="onPullDownRefresh"    scroll-top="{{scrollTop}}"

        <text class="error-text">åŠ è½½å¤±è´¥</text>

        <view class="retry-btn" bindtap="retryLoad">  >    bindscroll="onScroll"

          <text>é‡è¯•</text>

        </view>    <view class="content-container">    refresher-enabled="{{true}}"

      </view>

      <!-- ç¬¬ä¸€ç« æç¤º -->    refresher-threshold="80"

      <!-- ç« èŠ‚åº•éƒ¨æŒ‰é’® -->

      <view wx:if="{{!isLoading && chapterContent && currentChapterIndex < totalChapters - 1}}" class="chapter-end-hint">      <view wx:if="{{!isLoading && chapterContent && currentChapterIndex === 0}}" class="start-hint">    refresher-triggered="{{pullDownRefreshing}}"

        <view class="hint-btn" bindtap="nextChapter">

          <text>ğŸ‘‰ ä¸‹ä¸€ç« </text>        <text>ğŸ“– è¿™æ˜¯ç¬¬ä¸€ç« </text>    bindrefresherrefresh="onPullDownRefresh"

        </view>

      </view>      </view>  >



      <!-- æœ€åä¸€ç« æç¤º -->    <view class="content-container">

      <view wx:if="{{!isLoading && chapterContent && currentChapterIndex >= totalChapters - 1}}" class="end-hint">

        <text>ğŸ‰ å…¨ä¹¦å®Œ</text>      <!-- ç« èŠ‚æ ‡é¢˜ -->      <!-- ç¬¬ä¸€ç« æç¤º -->

      </view>

    </view>      <view class="chapter-title">{{chapterTitle}}</view>      <view wx:if="{{!isLoading && chapterContent && currentChapterIndex === 0}}" class="start-hint">

  </scroll-view>

              <text>ğŸ“– è¿™æ˜¯ç¬¬ä¸€ç« </text>

  <!-- åº•éƒ¨èœå• -->

  <view class="bottom-menu {{showMenu ? 'show' : ''}}">      <!-- åŠ è½½çŠ¶æ€ -->      </view>

    <!-- é˜…è¯»è¿›åº¦ -->

    <view class="progress-section">      <view wx:if="{{isLoading}}" class="loading-state">

      <text class="progress-text">ç¬¬ {{currentChapterIndex + 1}} / {{totalChapters}} ç« </text>

      <view class="progress-bar">        <text class="loading-icon">ğŸ“–</text>      <!-- ç« èŠ‚æ ‡é¢˜ -->

        <view class="progress-fill" style="width: {{(currentChapterIndex + 1) / totalChapters * 100}}%"></view>

      </view>        <text class="loading-text">åŠ è½½ä¸­...</text>      <view class="chapter-title">{{chapterTitle}}</view>

    </view>

      </view>      

    <!-- åŠŸèƒ½æŒ‰é’® -->

    <view class="menu-actions">      <!-- åŠ è½½çŠ¶æ€ -->

      <view class="action-item" bindtap="showChapterList">

        <text class="action-icon">ğŸ“‘</text>      <!-- ç« èŠ‚å†…å®¹ -->      <view wx:if="{{isLoading}}" class="loading-state">

        <text class="action-label">ç›®å½•</text>

      </view>      <view wx:if="{{!isLoading && chapterContent}}" class="chapter-content" style="font-size: {{fontSize}}px;">        <text class="loading-icon">ğŸ“–</text>

      <view class="action-item" bindtap="decreaseFontSize">

        <text class="action-icon">A-</text>        <text class="content-text" decode="{{true}}" space="{{true}}">{{chapterContent}}</text>        <text class="loading-text">åŠ è½½ä¸­...</text>

        <text class="action-label">ç¼©å°</text>

      </view>      </view>      </view>

      <view class="action-item" bindtap="increaseFontSize">

        <text class="action-icon">A+</text>

        <text class="action-label">æ”¾å¤§</text>

      </view>      <!-- åŠ è½½å¤±è´¥ -->      <!-- ç« èŠ‚å†…å®¹ -->

      <view class="action-item" bindtap="toggleNightMode">

        <text class="action-icon">{{themeClass === 'theme-night' ? 'â˜€ï¸' : 'ğŸŒ™'}}</text>      <view wx:if="{{!isLoading && !chapterContent}}" class="error-state">      <view wx:if="{{!isLoading && chapterContent}}" class="chapter-content" style="font-size: {{fontSize}}px;">

        <text class="action-label">{{themeClass === 'theme-night' ? 'æ—¥é—´' : 'å¤œé—´'}}</text>

      </view>        <text class="error-icon">ğŸ˜”</text>        <text class="content-text" decode="{{true}}" space="{{true}}">{{chapterContent}}</text>

    </view>

  </view>        <text class="error-text">åŠ è½½å¤±è´¥</text>      </view>



  <!-- ç« èŠ‚åˆ—è¡¨æŠ½å±‰ -->        <view class="retry-btn" bindtap="retryLoad">

  <view class="drawer-mask {{showChapterDrawer ? 'show' : ''}}" bindtap="closeChapterList"></view>

  <view class="chapter-drawer {{showChapterDrawer ? 'show' : ''}}">          <text>é‡è¯•</text>      <!-- åŠ è½½å¤±è´¥ -->

    <view class="drawer-header">

      <text class="drawer-title">ğŸ“‘ ç« èŠ‚ç›®å½•</text>        </view>      <view wx:if="{{!isLoading && !chapterContent}}" class="error-state">

      <view class="close-btn" bindtap="closeChapterList">

        <text>âœ•</text>      </view>        <text class="error-icon">ğŸ˜”</text>

      </view>

    </view>        <text class="error-text">åŠ è½½å¤±è´¥</text>

    <scroll-view class="chapter-list" scroll-y="{{true}}" scroll-into-view="chapter-{{currentChapterIndex}}">

      <view       <!-- ç« èŠ‚åº•éƒ¨æç¤º - ä½¿ç”¨èœå•åˆ‡æ¢ç« èŠ‚ -->        <view class="retry-btn" bindtap="retryLoad">

        wx:for="{{chapters}}" 

        wx:key="id"      <view wx:if="{{!isLoading && chapterContent && currentChapterIndex < totalChapters - 1}}" class="chapter-end-hint">          <text>é‡è¯•</text>

        id="chapter-{{index}}"

        class="chapter-item {{index === currentChapterIndex ? 'active' : ''}}"        <view class="hint-btn" bindtap="nextChapter">        </view>

        bindtap="selectChapter"

        data-index="{{index}}"          <text>ğŸ‘‰ ä¸‹ä¸€ç« </text>      </view>

      >

        <text class="chapter-number">{{index + 1}}</text>        </view>

        <text class="chapter-name">{{item.title}}</text>

      </view>      </view>      <!-- ç« èŠ‚åº•éƒ¨æç¤º - ä½¿ç”¨èœå•åˆ‡æ¢ç« èŠ‚ -->

    </scroll-view>

  </view>      <view wx:if="{{!isLoading && chapterContent && currentChapterIndex < totalChapters - 1}}" class="chapter-end-hint">



  <!-- è·³è½¬é¡µç å¼¹çª— -->      <!-- æœ€åä¸€ç« æç¤º -->        <text class="hint-text">å·²åˆ°æœ¬ç« æœ«å°¾</text>

  <view class="jump-modal {{showJumpModal ? 'show' : ''}}">

    <view class="modal-mask" bindtap="closeJumpModal"></view>      <view wx:if="{{!isLoading && chapterContent && currentChapterIndex >= totalChapters - 1}}" class="end-hint">        <view class="hint-actions">

    <view class="modal-content">

      <view class="modal-header">        <text>ğŸ‰ å…¨ä¹¦å®Œ</text>          <view class="hint-btn" bindtap="nextChapter">

        <text class="modal-title">è·³è½¬åˆ°æŒ‡å®šç« èŠ‚</text>

        <view class="modal-close" bindtap="closeJumpModal">âœ•</view>      </view>            <text>ï¿½ ä¸‹ä¸€ç« </text>

      </view>

      <view class="modal-body">    </view>          </view>

        <text class="input-label">è¯·è¾“å…¥ç« èŠ‚åºå·ï¼ˆ1-{{totalChapters}}ï¼‰</text>

        <input   </scroll-view>        </view>

          class="chapter-input"

          type="number"      </view>

          value="{{jumpChapterNumber}}"

          placeholder="è¯·è¾“å…¥ç« èŠ‚å·"  <!-- åº•éƒ¨èœå• -->

          bindinput="onJumpInputChange"

        />  <view class="bottom-menu {{showMenu ? 'show' : ''}}">      <!-- æœ€åä¸€ç« æç¤º -->

      </view>

      <view class="modal-footer">    <!-- é˜…è¯»è¿›åº¦ -->      <view wx:if="{{!isLoading && chapterContent && currentChapterIndex >= totalChapters - 1}}" class="end-hint">

        <view class="modal-btn cancel" bindtap="closeJumpModal">å–æ¶ˆ</view>

        <view class="modal-btn confirm" bindtap="confirmJump">è·³è½¬</view>    <view class="progress-section">        <text>ğŸ‰ å…¨ä¹¦å®Œ</text>

      </view>

    </view>      <text class="progress-text">ç¬¬ {{currentChapterIndex + 1}} / {{totalChapters}} ç« </text>      </view>

  </view>

</view>      <view class="progress-bar">    </view>


        <view class="progress-fill" style="width: {{(currentChapterIndex + 1) / totalChapters * 100}}%"></view>  </scroll-view>

      </view>

    </view>  <!-- åº•éƒ¨èœå• -->

  <view class="bottom-menu {{showMenu ? 'show' : ''}}">

    <!-- åŠŸèƒ½æŒ‰é’®ï¼ˆç®€åŒ–ç‰ˆï¼šç›®å½•ã€å­—å·è°ƒæ•´ã€å¤œé—´æ¨¡å¼ï¼‰-->    <!-- é˜…è¯»è¿›åº¦ -->

    <view class="menu-actions">    <view class="progress-section">

      <view class="action-item" bindtap="showChapterList">      <text class="progress-text">ç¬¬ {{currentChapterIndex + 1}} / {{totalChapters}} ç« </text>

        <text class="action-icon">ğŸ“‘</text>      <view class="progress-bar">

        <text class="action-label">ç›®å½•</text>        <view class="progress-fill" style="width: {{(currentChapterIndex + 1) / totalChapters * 100}}%"></view>

      </view>      </view>

      <view class="action-item" bindtap="decreaseFontSize">    </view>

        <text class="action-icon">A-</text>

        <text class="action-label">ç¼©å°</text>    <!-- åŠŸèƒ½æŒ‰é’®ï¼ˆç®€åŒ–ç‰ˆï¼šç›®å½•ã€å­—å·è°ƒæ•´ã€å¤œé—´æ¨¡å¼ï¼‰-->

      </view>    <view class="menu-actions">

      <view class="action-item" bindtap="increaseFontSize">      <view class="action-item" bindtap="showChapterList">

        <text class="action-icon">A+</text>        <text class="action-icon">ğŸ“‘</text>

        <text class="action-label">æ”¾å¤§</text>        <text class="action-label">ç›®å½•</text>

      </view>      </view>

      <view class="action-item" bindtap="toggleNightMode">      <view class="action-item" bindtap="decreaseFontSize">

        <text class="action-icon">{{themeClass === 'theme-night' ? 'â˜€ï¸' : 'ğŸŒ™'}}</text>        <text class="action-icon">A-</text>

        <text class="action-label">{{themeClass === 'theme-night' ? 'æ—¥é—´' : 'å¤œé—´'}}</text>        <text class="action-label">ç¼©å°</text>

      </view>      </view>

    </view>      <view class="action-item" bindtap="increaseFontSize">

  </view>        <text class="action-icon">A+</text>

        <text class="action-label">æ”¾å¤§</text>

  <!-- ç« èŠ‚åˆ—è¡¨æŠ½å±‰ -->      </view>

  <view class="drawer-mask {{showChapterDrawer ? 'show' : ''}}" bindtap="closeChapterList"></view>      <view class="action-item" bindtap="toggleNightMode">

  <view class="chapter-drawer {{showChapterDrawer ? 'show' : ''}}">        <text class="action-icon">{{themeClass === 'theme-night' ? 'â˜€ï¸' : 'ğŸŒ™'}}</text>

    <view class="drawer-header">        <text class="action-label">{{themeClass === 'theme-night' ? 'æ—¥é—´' : 'å¤œé—´'}}</text>

      <text class="drawer-title">ğŸ“‘ ç« èŠ‚ç›®å½•</text>      </view>

      <view class="close-btn" bindtap="closeChapterList">    </view>

        <text>âœ•</text>  </view>

      </view>

    </view>  <!-- ç« èŠ‚åˆ—è¡¨æŠ½å±‰ -->

    <scroll-view class="chapter-list" scroll-y="{{true}}" scroll-into-view="chapter-{{currentChapterIndex}}">  <view class="drawer-mask {{showChapterDrawer ? 'show' : ''}}" bindtap="closeChapterList"></view>

      <view   <view class="chapter-drawer {{showChapterDrawer ? 'show' : ''}}">

        wx:for="{{chapters}}"     <view class="drawer-header">

        wx:key="id"      <text class="drawer-title">ğŸ“‘ ç« èŠ‚ç›®å½•</text>

        id="chapter-{{index}}"      <view class="close-btn" bindtap="closeChapterList">

        class="chapter-item {{index === currentChapterIndex ? 'active' : ''}}"        <text>âœ•</text>

        bindtap="selectChapter"      </view>

        data-index="{{index}}"    </view>

      >    <scroll-view class="chapter-list" scroll-y="{{true}}" scroll-into-view="chapter-{{currentChapterIndex}}">

        <text class="chapter-number">{{index + 1}}</text>      <view 

        <text class="chapter-name">{{item.title}}</text>        wx:for="{{chapters}}" 

      </view>        wx:key="id"

    </scroll-view>        id="chapter-{{index}}"

  </view>        class="chapter-item {{index === currentChapterIndex ? 'active' : ''}}"

        bindtap="selectChapter"

  <!-- è·³è½¬é¡µç å¼¹çª— -->        data-index="{{index}}"

  <view class="jump-modal {{showJumpModal ? 'show' : ''}}">      >

    <view class="modal-mask" bindtap="closeJumpModal"></view>        <text class="chapter-number">{{index + 1}}</text>

    <view class="modal-content">        <text class="chapter-name">{{item.title}}</text>

      <view class="modal-header">      </view>

        <text class="modal-title">è·³è½¬åˆ°æŒ‡å®šç« èŠ‚</text>    </scroll-view>

        <view class="modal-close" bindtap="closeJumpModal">âœ•</view>  </view>

      </view>

      <view class="modal-body">  <!-- è·³è½¬é¡µç å¼¹çª— -->

        <text class="input-label">è¯·è¾“å…¥ç« èŠ‚åºå·ï¼ˆ1-{{totalChapters}}ï¼‰</text>  <view class="jump-modal {{showJumpModal ? 'show' : ''}}">

        <input     <view class="modal-mask" bindtap="closeJumpModal"></view>

          class="chapter-input"    <view class="modal-content">

          type="number"      <view class="modal-header">

          value="{{jumpChapterNumber}}"        <text class="modal-title">è·³è½¬åˆ°æŒ‡å®šç« èŠ‚</text>

          placeholder="è¯·è¾“å…¥ç« èŠ‚å·"        <view class="modal-close" bindtap="closeJumpModal">âœ•</view>

          bindinput="onJumpInputChange"      </view>

        />      <view class="modal-body">

      </view>        <text class="input-label">è¯·è¾“å…¥ç« èŠ‚åºå·ï¼ˆ1-{{totalChapters}}ï¼‰</text>

      <view class="modal-footer">        <input 

        <view class="modal-btn cancel" bindtap="closeJumpModal">å–æ¶ˆ</view>          class="chapter-input"

        <view class="modal-btn confirm" bindtap="confirmJump">è·³è½¬</view>          type="number"

      </view>          value="{{jumpChapterNumber}}"

    </view>          placeholder="è¯·è¾“å…¥ç« èŠ‚å·"

  </view>          bindinput="onJumpInputChange"

</view>        />

      </view>
      <view class="modal-footer">
        <view class="modal-btn cancel" bindtap="closeJumpModal">å–æ¶ˆ</view>
        <view class="modal-btn confirm" bindtap="confirmJump">è·³è½¬</view>
      </view>
    </view>
  </view>
</view>
