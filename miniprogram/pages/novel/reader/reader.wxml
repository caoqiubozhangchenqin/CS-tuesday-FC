<!-- pages/novel/reader/reader.wxml -->
<view class="container {{themeClass}}">
  <!-- å³ä¾§æ‚¬æµ®èœå•æŒ‰é’® -->
  <view class="floating-menu-btn" bindtap="toggleMenu">
    <text class="menu-icon">â˜°</text>
  </view>

  <!-- é¡¶éƒ¨æ ‡é¢˜æ ï¼ˆç®€åŒ–ç‰ˆï¼Œåªæ˜¾ç¤ºä¹¦åï¼‰-->
  <view class="header" wx:if="{{showHeader}}">
    <view class="header-center">
      <text class="book-title">{{bookName}}</text>
    </view>
  </view>

  <!-- ç« èŠ‚å†…å®¹ï¼ˆæ»šåŠ¨æ¨¡å¼ï¼‰-->
  <scroll-view 
    class="content-scroll" 
    scroll-y="{{true}}"
    bindtap="toggleHeader"
    scroll-top="{{scrollTop}}"
    bindscroll="onScroll"
    lower-threshold="100"
    upper-threshold="50"
    bindscrolltolower="onScrollToLower"
    bindscrolltoupper="onScrollToUpper"
  >
    <view class="content-container" style="font-size: {{fontSize}}px;">
      <!-- å‘ä¸Šæ»šåŠ¨æç¤ºï¼ˆåŠ è½½ä¸Šä¸€ç« ï¼‰-->
      <view wx:if="{{!isLoading && chapterContent && currentChapterIndex > 0}}" class="prev-chapter-hint">
        <text>ğŸ‘† ç»§ç»­å‘ä¸Šæ»šåŠ¨é˜…è¯»ä¸Šä¸€ç« </text>
      </view>

      <!-- ç¬¬ä¸€ç« æç¤º -->
      <view wx:if="{{!isLoading && chapterContent && currentChapterIndex === 0}}" class="start-hint">
        <text>ğŸ“– è¿™æ˜¯ç¬¬ä¸€ç« </text>
      </view>

      <!-- ç« èŠ‚æ ‡é¢˜ -->
      <view class="chapter-title">{{chapterTitle}}</view>
      
      <!-- åŠ è½½çŠ¶æ€ -->
      <view wx:if="{{isLoading}}" class="loading-state">
        <text class="loading-icon">ğŸ“–</text>
        <text class="loading-text">åŠ è½½ä¸­...</text>
      </view>

      <!-- ç« èŠ‚å†…å®¹ -->
      <view wx:if="{{!isLoading && chapterContent}}" class="chapter-content">
        <text class="content-text" decode="{{true}}" space="{{true}}">{{chapterContent}}</text>
      </view>

      <!-- åŠ è½½å¤±è´¥ -->
      <view wx:if="{{!isLoading && !chapterContent}}" class="error-state">
        <text class="error-icon">ğŸ˜”</text>
        <text class="error-text">åŠ è½½å¤±è´¥</text>
        <view class="retry-btn" bindtap="retryLoad">
          <text>é‡è¯•</text>
        </view>
      </view>

      <!-- æ»šåŠ¨åˆ°åº•éƒ¨æç¤ºï¼ˆè‡ªåŠ¨åŠ è½½ä¸‹ä¸€ç« ï¼‰-->
      <view wx:if="{{!isLoading && chapterContent && currentChapterIndex < totalChapters - 1}}" class="next-chapter-hint">
        <text>ğŸ‘‡ ç»§ç»­æ»šåŠ¨é˜…è¯»ä¸‹ä¸€ç« </text>
      </view>

      <!-- æœ€åä¸€ç« æç¤º -->
      <view wx:if="{{!isLoading && chapterContent && currentChapterIndex >= totalChapters - 1}}" class="end-hint">
        <text>ğŸ‰ å…¨ä¹¦å®Œ</text>
      </view>
    </view>
  </scroll-view>

  <!-- åº•éƒ¨èœå• -->
  <view class="bottom-menu {{showMenu ? 'show' : ''}}">
    <!-- é˜…è¯»è¿›åº¦ -->
    <view class="progress-section">
      <text class="progress-text">ç¬¬ {{currentChapterIndex + 1}} / {{totalChapters}} ç« </text>
      <view class="progress-bar">
        <view class="progress-fill" style="width: {{(currentChapterIndex + 1) / totalChapters * 100}}%"></view>
      </view>
    </view>

    <!-- åŠŸèƒ½æŒ‰é’® -->
    <view class="menu-actions">
      <view class="action-item" bindtap="showChapterList">
        <text class="action-icon">ğŸ“‘</text>
        <text class="action-label">ç›®å½•</text>
      </view>
      <view class="action-item" bindtap="showJumpToPage">
        <text class="action-icon">ï¿½</text>
        <text class="action-label">è·³è½¬</text>
      </view>
      <view class="action-item" bindtap="decreaseFontSize">
        <text class="action-icon">A-</text>
        <text class="action-label">ç¼©å°</text>
      </view>
      <view class="action-item" bindtap="increaseFontSize">
        <text class="action-icon">A+</text>
        <text class="action-label">æ”¾å¤§</text>
      </view>
      <view class="action-item" bindtap="toggleTheme">
        <text class="action-icon">ğŸ¨</text>
        <text class="action-label">ä¸»é¢˜</text>
      </view>
      <view class="action-item" bindtap="backToShelf">
        <text class="action-icon">ğŸ“š</text>
        <text class="action-label">ä¹¦æ¶</text>
      </view>
    </view>
  </view>

  <!-- ç« èŠ‚åˆ—è¡¨æŠ½å±‰ -->
  <view class="drawer-mask {{showChapterDrawer ? 'show' : ''}}" bindtap="closeChapterList"></view>
  <view class="chapter-drawer {{showChapterDrawer ? 'show' : ''}}">
    <view class="drawer-header">
      <text class="drawer-title">ğŸ“‘ ç« èŠ‚ç›®å½•</text>
      <view class="close-btn" bindtap="closeChapterList">
        <text>âœ•</text>
      </view>
    </view>
    <scroll-view class="chapter-list" scroll-y="{{true}}" scroll-into-view="chapter-{{currentChapterIndex}}">
      <view 
        wx:for="{{chapters}}" 
        wx:key="id"
        id="chapter-{{index}}"
        class="chapter-item {{index === currentChapterIndex ? 'active' : ''}}"
        bindtap="selectChapter"
        data-index="{{index}}"
      >
        <text class="chapter-number">{{index + 1}}</text>
        <text class="chapter-name">{{item.title}}</text>
      </view>
    </scroll-view>
  </view>

  <!-- è·³è½¬é¡µç å¼¹çª— -->
  <view class="jump-modal {{showJumpModal ? 'show' : ''}}">
    <view class="modal-mask" bindtap="closeJumpModal"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">è·³è½¬åˆ°æŒ‡å®šç« èŠ‚</text>
        <view class="modal-close" bindtap="closeJumpModal">âœ•</view>
      </view>
      <view class="modal-body">
        <text class="input-label">è¯·è¾“å…¥ç« èŠ‚åºå·ï¼ˆ1-{{totalChapters}}ï¼‰</text>
        <input 
          class="chapter-input"
          type="number"
          value="{{jumpChapterNumber}}"
          placeholder="è¯·è¾“å…¥ç« èŠ‚å·"
          bindinput="onJumpInputChange"
        />
      </view>
      <view class="modal-footer">
        <view class="modal-btn cancel" bindtap="closeJumpModal">å–æ¶ˆ</view>
        <view class="modal-btn confirm" bindtap="confirmJump">è·³è½¬</view>
      </view>
    </view>
  </view>
</view>
