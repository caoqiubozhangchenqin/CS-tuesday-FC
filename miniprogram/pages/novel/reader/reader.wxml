<!-- pages/novel/reader/reader.wxml -->
<view class="container {{themeClass}}">
  <!-- é¡¶éƒ¨æ ‡é¢˜æ  -->
  <view class="header" wx:if="{{showHeader}}">
    <view class="header-left" bindtap="goBack">
      <text class="back-icon">â†</text>
    </view>
    <view class="header-center">
      <text class="book-title">{{bookName}}</text>
    </view>
    <view class="header-right" bindtap="toggleMenu">
      <text class="menu-icon">â˜°</text>
    </view>
  </view>

  <!-- ç« èŠ‚å†…å®¹ -->
  <scroll-view 
    class="content-scroll" 
    scroll-y="{{true}}"
    bindtap="toggleHeader"
    scroll-top="{{scrollTop}}"
    bindscroll="onScroll"
  >
    <view class="content-container" style="font-size: {{fontSize}}px;">
      <!-- ç« èŠ‚æ ‡é¢˜ -->
      <view class="chapter-title">{{chapterTitle}}</view>
      
      <!-- åŠ è½½çŠ¶æ€ -->
      <view wx:if="{{isLoading}}" class="loading-state">
        <text class="loading-icon">ğŸ“–</text>
        <text class="loading-text">åŠ è½½ä¸­...</text>
      </view>

      <!-- ç« èŠ‚å†…å®¹ -->
      <view wx:if="{{!isLoading && chapterContent}}" class="chapter-content">
        <text>{{chapterContent}}</text>
      </view>

      <!-- åŠ è½½å¤±è´¥ -->
      <view wx:if="{{!isLoading && !chapterContent}}" class="error-state">
        <text class="error-icon">ğŸ˜”</text>
        <text class="error-text">åŠ è½½å¤±è´¥</text>
        <view class="retry-btn" bindtap="retryLoad">
          <text>é‡è¯•</text>
        </view>
      </view>

      <!-- ç« èŠ‚å¯¼èˆª -->
      <view wx:if="{{!isLoading && chapterContent}}" class="chapter-nav">
        <view 
          class="nav-btn {{currentChapterIndex === 0 ? 'disabled' : ''}}" 
          bindtap="previousChapter"
        >
          <text>â† ä¸Šä¸€ç« </text>
        </view>
        <view 
          class="nav-btn {{currentChapterIndex >= totalChapters - 1 ? 'disabled' : ''}}" 
          bindtap="nextChapter"
        >
          <text>ä¸‹ä¸€ç«  â†’</text>
        </view>
      </view>
    </view>
  </scroll-view>

  <!-- åº•éƒ¨èœå• -->
  <view class="bottom-menu {{showMenu ? 'show' : ''}}">
    <!-- è¿›åº¦æ¡ -->
    <view class="progress-section">
      <text class="progress-text">{{currentChapterIndex + 1}} / {{totalChapters}}</text>
      <slider 
        class="progress-slider"
        value="{{currentChapterIndex}}"
        min="0"
        max="{{totalChapters - 1}}"
        step="1"
        bindchange="onChapterChange"
        activeColor="#667eea"
        backgroundColor="#e0e0e0"
      />
    </view>

    <!-- åŠŸèƒ½æŒ‰é’® -->
    <view class="menu-actions">
      <view class="action-item" bindtap="showChapterList">
        <text class="action-icon">ğŸ“‘</text>
        <text class="action-label">ç›®å½•</text>
      </view>
      <view class="action-item" bindtap="decreaseFontSize">
        <text class="action-icon">A-</text>
        <text class="action-label">ç¼©å°</text>
      </view>
      <view class="action-item" bindtap="increaseFontSize">
        <text class="action-icon">A+</text>
        <text class="action-label">æ”¾å¤§</text>
      </view>
      <view class="action-item" bindtap="toggleTheme">
        <text class="action-icon">ğŸ¨</text>
        <text class="action-label">ä¸»é¢˜</text>
      </view>
    </view>
  </view>

  <!-- ç« èŠ‚åˆ—è¡¨æŠ½å±‰ -->
  <view class="drawer-mask {{showChapterDrawer ? 'show' : ''}}" bindtap="closeChapterList"></view>
  <view class="chapter-drawer {{showChapterDrawer ? 'show' : ''}}">
    <view class="drawer-header">
      <text class="drawer-title">ğŸ“‘ ç« èŠ‚ç›®å½•</text>
      <view class="close-btn" bindtap="closeChapterList">
        <text>âœ•</text>
      </view>
    </view>
    <scroll-view class="chapter-list" scroll-y="{{true}}" scroll-into-view="chapter-{{currentChapterIndex}}">
      <view 
        wx:for="{{chapters}}" 
        wx:key="id"
        id="chapter-{{index}}"
        class="chapter-item {{index === currentChapterIndex ? 'active' : ''}}"
        bindtap="selectChapter"
        data-index="{{index}}"
      >
        <text class="chapter-number">{{index + 1}}</text>
        <text class="chapter-name">{{item.title}}</text>
      </view>
    </scroll-view>
  </view>
</view>
