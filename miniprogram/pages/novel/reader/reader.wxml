<!-- pages/novel/reader/reader.wxml -->
<view class="container {{themeClass}}">
  <!-- щб╢щГицаЗщвШцаП -->
  <view class="header" wx:if="{{showHeader}}">
    <view class="header-left" bindtap="toggleMenu">
      <text class="menu-icon">тШ░</text>
    </view>
    <view class="header-center">
      <text class="book-title">{{bookName}}</text>
    </view>
    <view class="header-right" bindtap="backToShelf">
      <text class="back-icon">ЁЯУЪ</text>
    </view>
  </view>

  <!-- члашКВхЖЕхо╣я╝Иц╗ЪхКицибх╝Пя╝Й-->
  <scroll-view 
    class="content-scroll" 
    scroll-y="{{true}}"
    bindtap="toggleHeader"
    scroll-top="{{scrollTop}}"
    bindscroll="onScroll"
    lower-threshold="100"
    upper-threshold="50"
    bindscrolltolower="onScrollToLower"
    bindscrolltoupper="onScrollToUpper"
  >
    <view class="content-container" style="font-size: {{fontSize}}px;">
      <!-- хРСф╕Кц╗ЪхКицПРчд║я╝ИхКаш╜╜ф╕Кф╕Ачлая╝Й-->
      <view wx:if="{{!isLoading && chapterContent && currentChapterIndex > 0}}" class="prev-chapter-hint">
        <text>ЁЯСЖ ч╗зч╗нхРСф╕Кц╗ЪхКищШЕшп╗ф╕Кф╕Ачла</text>
      </view>

      <!-- чммф╕АчлацПРчд║ -->
      <view wx:if="{{!isLoading && chapterContent && currentChapterIndex === 0}}" class="start-hint">
        <text>ЁЯУЦ ш┐ЩцШпчммф╕Ачла</text>
      </view>

      <!-- члашКВцаЗщвШ -->
      <view class="chapter-title">{{chapterTitle}}</view>
      
      <!-- хКаш╜╜чК╢цАБ -->
      <view wx:if="{{isLoading}}" class="loading-state">
        <text class="loading-icon">ЁЯУЦ</text>
        <text class="loading-text">хКаш╜╜ф╕н...</text>
      </view>

      <!-- члашКВхЖЕхо╣ -->
      <view wx:if="{{!isLoading && chapterContent}}" class="chapter-content">
        <text class="content-text" decode="{{true}}" space="{{true}}">{{chapterContent}}</text>
      </view>

      <!-- хКаш╜╜хд▒ш┤е -->
      <view wx:if="{{!isLoading && !chapterContent}}" class="error-state">
        <text class="error-icon">ЁЯШФ</text>
        <text class="error-text">хКаш╜╜хд▒ш┤е</text>
        <view class="retry-btn" bindtap="retryLoad">
          <text>щЗНшпХ</text>
        </view>
      </view>

      <!-- ц╗ЪхКихИ░х║ХщГицПРчд║я╝ИшЗкхКихКаш╜╜ф╕Лф╕Ачлая╝Й-->
      <view wx:if="{{!isLoading && chapterContent && currentChapterIndex < totalChapters - 1}}" class="next-chapter-hint">
        <text>ЁЯСЗ ч╗зч╗нц╗ЪхКищШЕшп╗ф╕Лф╕Ачла</text>
      </view>

      <!-- цЬАхРОф╕АчлацПРчд║ -->
      <view wx:if="{{!isLoading && chapterContent && currentChapterIndex >= totalChapters - 1}}" class="end-hint">
        <text>ЁЯОЙ хЕиф╣жхоМ</text>
      </view>
    </view>
  </scroll-view>

  <!-- х║ХщГишПЬхНХ -->
  <view class="bottom-menu {{showMenu ? 'show' : ''}}">
    <!-- щШЕшп╗ш┐Ых║ж -->
    <view class="progress-section">
      <text class="progress-text">чмм {{currentChapterIndex + 1}} / {{totalChapters}} чла</text>
      <view class="progress-bar">
        <view class="progress-fill" style="width: {{(currentChapterIndex + 1) / totalChapters * 100}}%"></view>
      </view>
    </view>

    <!-- хКЯшГ╜цМЙщТо -->
    <view class="menu-actions">
      <view class="action-item" bindtap="showChapterList">
        <text class="action-icon">ЁЯУС</text>
        <text class="action-label">чЫох╜Х</text>
      </view>
      <view class="action-item" bindtap="showJumpToPage">
        <text class="action-icon">я┐╜</text>
        <text class="action-label">ш╖│ш╜м</text>
      </view>
      <view class="action-item" bindtap="decreaseFontSize">
        <text class="action-icon">A-</text>
        <text class="action-label">ч╝йх░П</text>
      </view>
      <view class="action-item" bindtap="increaseFontSize">
        <text class="action-icon">A+</text>
        <text class="action-label">цФ╛хдз</text>
      </view>
      <view class="action-item" bindtap="toggleTheme">
        <text class="action-icon">ЁЯОи</text>
        <text class="action-label">ф╕╗щвШ</text>
      </view>
    </view>
  </view>

  <!-- члашКВхИЧшбицК╜х▒Й -->
  <view class="drawer-mask {{showChapterDrawer ? 'show' : ''}}" bindtap="closeChapterList"></view>
  <view class="chapter-drawer {{showChapterDrawer ? 'show' : ''}}">
    <view class="drawer-header">
      <text class="drawer-title">ЁЯУС члашКВчЫох╜Х</text>
      <view class="close-btn" bindtap="closeChapterList">
        <text>тЬХ</text>
      </view>
    </view>
    <scroll-view class="chapter-list" scroll-y="{{true}}" scroll-into-view="chapter-{{currentChapterIndex}}">
      <view 
        wx:for="{{chapters}}" 
        wx:key="id"
        id="chapter-{{index}}"
        class="chapter-item {{index === currentChapterIndex ? 'active' : ''}}"
        bindtap="selectChapter"
        data-index="{{index}}"
      >
        <text class="chapter-number">{{index + 1}}</text>
        <text class="chapter-name">{{item.title}}</text>
      </view>
    </scroll-view>
  </view>

  <!-- ш╖│ш╜мщб╡чаБх╝╣чкЧ -->
  <view class="jump-modal {{showJumpModal ? 'show' : ''}}">
    <view class="modal-mask" bindtap="closeJumpModal"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">ш╖│ш╜мхИ░цМЗхоЪчлашКВ</text>
        <view class="modal-close" bindtap="closeJumpModal">тЬХ</view>
      </view>
      <view class="modal-body">
        <text class="input-label">шп╖ш╛УхЕечлашКВх║ПхП╖я╝И1-{{totalChapters}}я╝Й</text>
        <input 
          class="chapter-input"
          type="number"
          value="{{jumpChapterNumber}}"
          placeholder="шп╖ш╛УхЕечлашКВхП╖"
          bindinput="onJumpInputChange"
        />
      </view>
      <view class="modal-footer">
        <view class="modal-btn cancel" bindtap="closeJumpModal">хПЦц╢И</view>
        <view class="modal-btn confirm" bindtap="confirmJump">ш╖│ш╜м</view>
      </view>
    </view>
  </view>
</view>
