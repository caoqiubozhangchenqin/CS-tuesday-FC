<!--pages/novel/debug/debug.wxml-->
<view class="debug-container">
  <view class="debug-header">
    <text class="debug-title">追书神器API调试</text>
  </view>

  <!-- 配置检查 -->
  <view class="debug-section">
    <view class="section-title">⚙️ 配置检查</view>
    <view class="config-item">
      <text class="label">当前API地址：</text>
      <text class="value">{{currentApi}}</text>
    </view>
    <view class="config-item">
      <text class="label">域名校验：</text>
      <text class="value {{domainCheck ? 'warning' : 'success'}}">
        {{domainCheck ? '已开启（需配置白名单）' : '已关闭（开发模式）'}}
      </text>
    </view>
    <button class="test-btn" bindtap="switchApi">切换API地址</button>
  </view>

  <!-- 搜索测试 -->
  <view class="debug-section">
    <view class="section-title">🔍 搜索测试</view>
    <input 
      class="search-input" 
      placeholder="输入书名，如：斗破苍穹" 
      value="{{testKeyword}}"
      bindinput="onKeywordInput"
    />
    <button class="test-btn primary" bindtap="testSearch" loading="{{isSearching}}">
      {{isSearching ? '搜索中...' : '测试搜索'}}
    </button>
    
    <view wx:if="{{searchResult}}" class="result-box">
      <view class="result-title">搜索结果：</view>
      <text class="result-text">{{searchResult}}</text>
    </view>
  </view>

  <!-- 章节列表测试 -->
  <view class="debug-section">
    <view class="section-title">📚 章节列表测试</view>
    <input 
      class="search-input" 
      placeholder="输入书籍ID" 
      value="{{testBookId}}"
      bindinput="onBookIdInput"
    />
    <button class="test-btn primary" bindtap="testChapterList" loading="{{isLoadingChapters}}">
      {{isLoadingChapters ? '获取中...' : '测试章节列表'}}
    </button>
    
    <view wx:if="{{chapterResult}}" class="result-box">
      <view class="result-title">章节结果：</view>
      <text class="result-text">{{chapterResult}}</text>
    </view>
  </view>

  <!-- 网络诊断 -->
  <view class="debug-section">
    <view class="section-title">🌐 网络诊断</view>
    <button class="test-btn" bindtap="testNetwork">测试网络连接</button>
    
    <view wx:if="{{networkResult}}" class="result-box">
      <text class="result-text">{{networkResult}}</text>
    </view>
  </view>

  <!-- 云存储查询 -->
  <view class="debug-section">
    <view class="section-title">☁️ 云存储查询</view>
    <button class="test-btn primary" bindtap="queryCloudBooks">
      查询云端书籍 {{cloudBooksCount > 0 ? '(' + cloudBooksCount + ')' : ''}}
    </button>
    
    <view wx:if="{{cloudStorageInfo}}" class="result-box">
      <view class="result-title">云存储信息：</view>
      <text class="result-text">{{cloudStorageInfo}}</text>
    </view>
  </view>

  <!-- 控制台日志提示 -->
  <view class="debug-section">
    <view class="section-title">📝 调试提示</view>
    <view class="tip-box">
      <text class="tip-text">1. 打开控制台查看详细日志</text>
      <text class="tip-text">2. 检查「不校验合法域名」是否勾选</text>
      <text class="tip-text">3. 确认网络连接正常</text>
      <text class="tip-text">4. 查看API响应状态码和数据</text>
      <text class="tip-text">5. 云开发环境需要正确初始化</text>
    </view>
  </view>
</view>
