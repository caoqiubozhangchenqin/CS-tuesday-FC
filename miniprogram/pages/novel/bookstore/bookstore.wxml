<view class="bookstore-container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-text">åŠ è½½ä¸­...</view>
  </view>

  <!-- ä¹¦åŸå†…å®¹ -->
  <view wx:else class="bookstore-content">
    
    <!-- æ¨èåŒº -->
    <view class="section recommend-section">
      <view class="section-header">
        <text class="section-title">ğŸ”¥ ç²¾é€‰æ¨è</text>
      </view>
      
      <scroll-view scroll-x class="recommend-scroll" wx:if="{{recommendBooks.length > 0}}">
        <view class="recommend-list">
          <view 
            class="recommend-item" 
            wx:for="{{recommendBooks}}" 
            wx:key="_id"
            bindtap="openBook" 
            data-id="{{item._id}}"
            data-novel="{{item}}">
            
            <image 
              src="{{item.cover || '/images/default-book-cover.png'}}" 
              class="recommend-cover"
              mode="aspectFill"/>
            
            <view class="recommend-info">
              <text class="recommend-title">{{item.title}}</text>
              <text class="recommend-author">{{item.author}}</text>
              <text class="recommend-stats">{{item.viewCount}}äººé˜…è¯»</text>
            </view>
          </view>
        </view>
      </scroll-view>

      <view wx:else class="empty-hint">
        <text>æš‚æ— æ¨èå°è¯´</text>
      </view>
    </view>

    <!-- åˆ†ç±»æ ‡ç­¾ -->
    <view class="category-tabs">
      <view 
        class="category-tab {{activeCategory === 'å…¨éƒ¨' ? 'active' : ''}}"
        bindtap="switchCategory"
        data-category="å…¨éƒ¨">
        å…¨éƒ¨
      </view>
      <view 
        class="category-tab {{activeCategory === item ? 'active' : ''}}"
        wx:for="{{categories}}"
        wx:key="*this"
        bindtap="switchCategory"
        data-category="{{item}}">
        {{item}}
      </view>
    </view>

    <!-- åˆ†ç±»åˆ—è¡¨ -->
    <view class="category-content">
      <!-- å…¨éƒ¨åˆ†ç±» -->
      <view wx:if="{{activeCategory === 'å…¨éƒ¨'}}">
        <block wx:for="{{categories}}" wx:key="*this" wx:for-item="category">
          <view class="section" wx:if="{{categoryBooks[category] && categoryBooks[category].length > 0}}">
            <view class="section-header">
              <text class="section-title">ğŸ“– {{category}}</text>
              <text class="section-count">({{categoryBooks[category].length}}æœ¬)</text>
            </view>
            
            <view class="book-grid">
              <view 
                class="book-item" 
                wx:for="{{categoryBooks[category]}}" 
                wx:key="_id"
                wx:for-item="book"
                bindtap="openBook" 
                data-id="{{book._id}}"
                data-novel="{{book}}">
                
                <image 
                  src="{{book.cover || '/images/default-book-cover.png'}}" 
                  class="book-cover"
                  mode="aspectFill"/>
                
                <view class="book-info">
                  <text class="book-title">{{book.title}}</text>
                  <text class="book-author">{{book.author}}</text>
                  <text class="book-stats">
                    {{book.totalPages || 0}}é¡µ Â· {{book.viewCount || 0}}äººè¯»è¿‡
                  </text>
                </view>

                <!-- æ·»åŠ åˆ°ä¹¦æ¶æŒ‰é’® -->
                <view 
                  class="add-shelf-btn"
                  catchtap="addToShelf"
                  data-id="{{book._id}}"
                  data-novel="{{book}}">
                  <text>+</text>
                </view>
              </view>
            </view>
          </view>
        </block>
      </view>

      <!-- å•ä¸ªåˆ†ç±» -->
      <view wx:else>
        <view class="section" wx:if="{{categoryBooks[activeCategory] && categoryBooks[activeCategory].length > 0}}">
          <view class="book-grid">
            <view 
              class="book-item" 
              wx:for="{{categoryBooks[activeCategory]}}" 
              wx:key="_id"
              bindtap="openBook" 
              data-id="{{item._id}}"
              data-novel="{{item}}">
              
              <image 
                src="{{item.cover || '/images/default-book-cover.png'}}" 
                class="book-cover"
                mode="aspectFill"/>
              
              <view class="book-info">
                <text class="book-title">{{item.title}}</text>
                <text class="book-author">{{item.author}}</text>
                <text class="book-stats">
                  {{item.totalPages || 0}}é¡µ Â· {{item.viewCount || 0}}äººè¯»è¿‡
                </text>
              </view>

              <view 
                class="add-shelf-btn"
                catchtap="addToShelf"
                data-id="{{item._id}}"
                data-novel="{{item}}">
                <text>+</text>
              </view>
            </view>
          </view>
        </view>

        <view wx:else class="empty-hint">
          <text>è¯¥åˆ†ç±»æš‚æ— å°è¯´</text>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:if="{{recommendBooks.length === 0 && Object.keys(categoryBooks).length === 0}}" class="empty-state">
      <text class="empty-icon">ğŸ“š</text>
      <text class="empty-text">ä¹¦åŸæ­£åœ¨å»ºè®¾ä¸­...</text>
      <text class="empty-hint">ç®¡ç†å‘˜å¯ä»¥ä¸Šä¼ å°è¯´åˆ°å…¬å…±åº“</text>
    </view>
  </view>
</view>
