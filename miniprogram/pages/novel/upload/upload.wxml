<!--pages/novel/upload/upload.wxml-->
<view class="upload-container">
  <view class="upload-header">
    <text class="header-title">📤 上传小说</text>
    <text class="header-desc">支持 TXT、EPUB 格式</text>
    <view wx:if="{{isAdmin}}" class="admin-badge">
      <text class="badge-icon">👑</text>
      <text class="badge-text">管理员</text>
    </view>
  </view>

  <!-- 权限提示 - 非管理员 -->
  <view wx:if="{{!isAdmin}}" class="permission-denied">
    <text class="denied-icon">🔒</text>
    <text class="denied-title">权限不足</text>
    <text class="denied-desc">上传书籍功能仅限管理员使用</text>
    <button class="back-btn" bindtap="goBack">返回书架</button>
  </view>

  <!-- 上传区域 - 仅管理员可见 -->
  <view wx:if="{{isAdmin}}" class="upload-section">
    <button class="upload-btn" bindtap="chooseFiles">
      <text class="upload-icon">📁</text>
      <text class="upload-text">批量选择文件</text>
    </button>
    
    <view wx:if="{{selectedFiles && selectedFiles.length > 0}}" class="file-info">
      <view wx:for="{{selectedFiles}}" wx:key="index" class="file-item">
        <text class="file-icon">📄</text>
        <view class="file-details">
          <text class="file-name">{{item.name}}</text>
          <text class="file-size">{{item.sizeText}}</text>
        </view>
        <text class="file-close" bindtap="removeFile" data-index="{{index}}">✕</text>
      </view>
    </view>
  </view>

  <!-- 书籍信息 -->
  <view wx:if="{{selectedFiles && selectedFiles.length > 0}}" class="book-info-section">
    <view class="batch-info">
      <text class="batch-icon">📚</text>
      <text class="batch-text">已选择 {{selectedFiles.length}} 个文件</text>
    </view>

    <button 
      class="submit-btn" 
      bindtap="uploadBooks" 
      loading="{{isUploading}}"
      disabled="{{isUploading}}"
    >
      {{isUploading ? '上传中...' : '批量上传到云端'}}
    </button>
  </view>

  <!-- 上传进度 -->
  <view wx:if="{{uploadProgress > 0 && uploadProgress < 100}}" class="progress-section">
    <text class="progress-text">上传进度：{{currentFile}}/{{totalFiles}} ({{uploadProgress}}%)</text>
    <view class="progress-bar">
      <view class="progress-fill" style="width: {{uploadProgress}}%"></view>
    </view>
  </view>

  <!-- 我的云端书籍 -->
  <view class="cloud-books-section">
    <view class="section-header">
      <text class="section-title">☁️ 云端书籍</text>
      <text class="section-count">{{cloudBooks.length}} 本</text>
    </view>

    <view wx:if="{{cloudBooks.length === 0}}" class="empty-state">
      <text class="empty-icon">📚</text>
      <text class="empty-text">还没有上传书籍</text>
    </view>

    <view wx:else class="book-list">
      <view 
        wx:for="{{cloudBooks}}" 
        wx:key="id" 
        class="book-item"
        bindtap="viewBook"
        data-book="{{item}}"
      >
        <view class="book-left">
          <text class="book-format">{{item.format}}</text>
          <view class="book-info">
            <text class="book-name">{{item.name}}</text>
            <text class="book-author">{{item.author}}</text>
            <text class="book-size">{{item.sizeText}}</text>
          </view>
        </view>
        <view class="book-actions">
          <text class="action-btn" catchtap="downloadBook" data-book="{{item}}">📥</text>
          <text class="action-btn delete" catchtap="deleteBook" data-id="{{item.id}}">🗑️</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 使用说明 -->
  <view class="tips-section">
    <view class="tips-title">💡 使用说明</view>
    <view class="tips-list">
      <text class="tip-item">• 支持 TXT 和 EPUB 格式</text>
      <text class="tip-item">• 单个文件不超过 10MB</text>
      <text class="tip-item">• EPUB 会自动解析章节</text>
      <text class="tip-item">• TXT 按空行自动分章</text>
      <text class="tip-item">• 上传后可在书架中阅读</text>
    </view>
  </view>
</view>
