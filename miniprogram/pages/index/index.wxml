<!-- pages/index/index.wxml -->
<bg src="cloud://cloud1-3ge5gomsffe800a7.636c-cloud1-3ge5gomsffe800a7-1373366709/csfc_bg/guoqing.jpg" overlayOpacity="0.3" blur="0" sizeMode="cover" repeat="false" />
<view class="container main-container">

<!-- Part 1: 头部信息区 -->
<view class="welcome-header">
  <block wx:if="{{hasUserInfo}}">
    <image class="welcome-avatar" src="{{userInfo.avatarUrl}}" mode="aspectFill"></image>
    <view class="welcome-text">欢迎回来, {{userInfo.nickname}}</view>
  </block>
  <block wx:else>
    <image class="welcome-avatar" src="/images/avatar.png" mode="aspectFill"></image>
    <button class="login-prompt-btn" bindtap="handleLogin">点击登录</button>
  </block>
</view>

<!-- Part 2: 功能按钮列表 -->
<view class="button-group">
  <!-- 【修改点】所有主要功能按钮现在都使用统一的 'menu-button primary-btn' class -->
  <button class="menu-button primary-btn" bindtap="goToSurvey">开始评估</button>
  <button class="menu-button primary-btn" bindtap="goToRanking">身价排行榜</button>
  <button class="menu-button primary-btn" bindtap="goToTeamStatusPage">各队报名情况</button>
  <button class="menu-button primary-btn" bindtap="goToSchedulePage">查看联赛赛程</button>
  <button class="menu-button primary-btn" bindtap="goToStandingsPage">查看联赛积分榜</button>
  
  <!-- 特殊颜色按钮保持不变 -->
  <button class="menu-button admin-button" bindtap="goToAdminPage">进入管理员页面</button>
  <button wx:if="{{hasUserInfo}}" class="menu-button logout-button" bindtap="logout">退出登录</button>
</view>

<!-- 音乐播放器图标 -->
<view class="music-icon-wrapper {{isMusicPlaying ? 'playing' : ''}}" bindtap="toggleMusic">
  <image class="music-icon" src="/images/music-icon.png" mode="aspectFit" />
</view>

</view>


<!-- Part 3: 登录弹窗 (代码保持不变) -->
<view class="popup-mask" wx:if="{{showLoginPopup}}" bindtap="closeLoginPopup"></view>
<view class="popup-container" wx:if="{{showLoginPopup}}">
<view class="title">授权登录</view>
<view class="subtitle">请设置您的头像和昵称</view>

<view class="avatar-circle">
  <image class="avatar-image" src="{{avatarUrl}}" mode="aspectFill"></image>
  <button 
    class="avatar-btn" 
    open-type="chooseAvatar" 
    bind:chooseavatar="onChooseAvatar"
    bindtap="onAvatarWrapperTap"
    disabled="{{isChoosingAvatar}}"
  ></button>
</view>
<view class="avatar-tip">点击上方选择头像</view>

<view class="nickname-wrapper">
  <input class="nickname-input" type="nickname" placeholder="请输入昵称" value="{{nickname}}" bindinput="onNicknameInput"/>
</view>

<button class="save-button" bindtap="saveNickname">保存并进入</button>
</view>