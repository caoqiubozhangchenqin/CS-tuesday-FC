<!-- pages/index/index.wxml -->
<bg src="cloud://cloud1-3ge5gomsffe800a7.636c-cloud1-3ge5gomsffe800a7-1373366709/csfc_bg/sunderland-official-2026.png" overlayOpacity="0.4" blur="0" sizeMode="cover" repeat="false" />
<view class="container main-container">

<!-- 桑德兰队庆祝标题 -->
<view class="champion-banner">
  <text class="champion-text">⚽ 英超荣耀 - 桑德兰队 ⚽</text>
  <text class="champion-subtitle">欢迎来到桑德兰足球俱乐部！</text>
</view>

<!-- Part 1: 头部信息区 -->
<view class="welcome-header">
  <block wx:if="{{hasUserInfo}}">
    <image class="welcome-avatar" src="{{userInfo.avatarUrl}}" mode="aspectFill"></image>
    <view class="welcome-text">欢迎回来, {{userInfo.nickname}}</view>
    <!-- 签到按钮 - 紧贴在欢迎信息下方 -->
    <button bindtap="onSignIn" class="sign-in-button">
      <text class="sign-in-icon">📅</text>
      <text class="sign-in-text">每日签到</text>
    </button>
  </block>
  <block wx:else>
    <image class="welcome-avatar" src="/images/avatar.png" mode="aspectFill"></image>
    <button class="login-prompt-btn" bindtap="handleLogin">点击登录</button>
  </block>
</view>

<!-- 功能按钮列表 -->
<view class="button-group">
  <!-- 新用户显示开始评估按钮 -->
  <button wx:if="{{showSurveyButton}}" class="menu-button primary-btn" bindtap="goToSurvey">  开始评估</button>
  <!-- 已评估用户显示灰色不可用的开始评估按钮 -->
  <button wx:elif="{{userValue > 0}}" class="menu-button primary-btn disabled" disabled>  已评估</button>
  
  <!-- 身价信息显示区域 -->
  <view wx:if="{{userValue > 0}}" class="user-value-display">
    <block wx:if="{{selectedTeam}}">
      <text class="value-label">我的身价</text>
      <text class="value-amount">¥{{userValue}}万</text>
      <text class="team-info">已选择：{{selectedTeamName}}</text>
    </block>
    <block wx:else>
      <text class="value-label">球队信息</text>
      <text class="team-info warning">请立即选择您的球队</text>
    </block>
  </view>
  
  <!-- 签约球队相关按钮 -->
  <button wx:if="{{userValue > 0}}" class="menu-button primary-btn" bindtap="goToTeamSignup">  {{selectedTeam ? '更换球队' : '选择球队'}}</button>
  
  <button class="menu-button primary-btn" bindtap="goToRanking">  身价排行榜</button>
  <button class="menu-button primary-btn" bindtap="goToTeamStatusPage">  各队报名情况</button>
  <button class="menu-button primary-btn" bindtap="goToSchedulePage">  查看联赛赛程</button>
  <button class="menu-button primary-btn" bindtap="goToStandingsPage">  查看联赛积分榜</button>
  <button class="menu-button primary-btn" bindtap="goToLeagueRecordsPage">  bug提交</button>
  
  <button class="menu-button admin-button" bindtap="goToAdminPage">  进入管理员页面</button>
  <button wx:if="{{hasUserInfo}}" class="menu-button logout-button" bindtap="logout">  退出登录</button>
</view>

<!-- 音乐播放器图标 -->
<view class="music-icon-wrapper {{isMusicPlaying ? 'playing' : ''}}" bindtap="toggleMusic">
  <image class="music-icon" src="/images/music-icon.png" mode="aspectFit" />
</view>

</view>


<!-- Part 3: 登录弹窗 (代码保持不变) -->
<view class="popup-mask" wx:if="{{showLoginPopup}}" bindtap="closeLoginPopup"></view>
<view class="popup-container" wx:if="{{showLoginPopup}}">
<view class="title">授权登录</view>
<view class="subtitle">请设置您的头像和昵称</view>

<view class="avatar-circle">
  <image class="avatar-image" src="{{avatarUrl}}" mode="aspectFill"></image>
  <button 
    class="avatar-btn" 
    open-type="chooseAvatar" 
    bind:chooseavatar="onChooseAvatar"
    bindtap="onAvatarWrapperTap"
    disabled="{{isChoosingAvatar}}"
  ></button>
</view>
<view class="avatar-tip">点击上方选择头像</view>

<view class="nickname-wrapper">
  <input class="nickname-input" type="nickname" placeholder="请输入昵称" value="{{nickname}}" bindinput="onNicknameInput"/>
</view>

<button class="save-button" bindtap="saveNickname">保存并进入</button>
</view>