<!-- 管理员上传小说页面（美化版） -->
<bg src="cloud://cloud1-3ge5gomsffe800a7.636c-cloud1-3ge5gomsffe800a7-1373366709/csfc_bg/足球.png" overlayOpacity="0.3" blur="0" sizeMode="cover" repeat="false" />
<view class="container">

  <!-- 优化标题布局 -->
  <view class="title">
    <text>📚 上传小说</text>
  </view>
  <view class="form">
    <!-- 显示选中的文件信息 -->
    <view class="file-info" wx:if="{{selectedFile}}">
      <view class="file-info-header">
        <text class="info-title">📋 文件信息</text>
      </view>
      <view class="info-row">
        <text class="label">📖 书名</text>
        <text class="value">{{selectedFile.bookTitle}}</text>
      </view>
      <view class="info-row">
        <text class="label">📄 文件</text>
        <text class="value">{{selectedFile.name}}</text>
      </view>
      <view class="info-row">
        <text class="label">💾 大小</text>
        <text class="value">{{fileSizeText}}</text>
      </view>
    </view>

    <!-- 选择文件按钮 -->
    <button class="choose-btn" bindtap="chooseFile">
      <text class="btn-icon">📁</text>
      <text class="btn-text">{{selectedFile ? '重新选择' : '选择 TXT 文件'}}</text>
    </button>

    <!-- 上传按钮 -->
    <button 
      class="upload-btn" 
      bindtap="startUpload"
      disabled="{{uploading || !selectedFile}}"
    >
      <text class="btn-icon" wx:if="{{!uploading}}">🚀</text>
      <text class="btn-icon loading-icon" wx:else>⏳</text>
      <text class="btn-text">{{uploading ? '上传中...' : '开始上传'}}</text>
    </button>
  </view>

  <!-- 已上传小说列表 -->
  <view class="novel-list-section">
    <view class="section-header">
      <text class="section-title">📚 已上传小说</text>
      <text class="section-count">共 {{novelList.length}} 本</text>
    </view>

    <view wx:if="{{loading}}" class="list-loading">
      <text class="loading-icon">⏳</text>
      <text class="loading-text">加载中...</text>
    </view>

    <view wx:elif="{{novelList.length > 0}}" class="novel-list">
      <view wx:for="{{novelList}}" wx:key="_id" class="novel-card">
        <view class="novel-content">
          <text class="novel-title">{{item.title}}</text>
          <text class="novel-time">{{item.uploadTime}}</text>
        </view>
        <view class="novel-actions">
          <button 
            class="delete-btn" 
            bindtap="deleteNovel" 
            data-novel="{{item}}"
          >
            <text class="delete-icon">删除</text>
          </button>
        </view>
      </view>
    </view>

    <view wx:else class="list-empty">
      <text class="empty-icon">📚</text>
      <text class="empty-text">还没有上传小说</text>
    </view>
  </view>
</view>

<!-- 自定义删除确认弹窗 -->
<view class="delete-modal" wx:if="{{showDeleteModal}}">
  <view class="modal-overlay" bindtap="hideDeleteModal"></view>
  <view class="modal-content">
    <view class="modal-header">
      <text class="modal-title">⚠️ 确认删除</text>
    </view>
    <view class="modal-body">
      <text class="modal-message">确定要删除《{{deleteNovelTitle}}》吗？</text>
      <text class="modal-warning">此操作不可恢复！</text>
    </view>
    <view class="modal-footer">
      <button class="modal-btn cancel-btn" bindtap="hideDeleteModal">取消</button>
      <button class="modal-btn confirm-btn" bindtap="confirmDeleteNovel">确认删除</button>
    </view>
  </view>
</view>
