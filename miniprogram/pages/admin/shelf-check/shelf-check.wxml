<view class="container">
  <!-- å¤´éƒ¨ -->
  <view class="header">
    <text class="title">ğŸ” ä¹¦æ¶é‡å¤æ£€æŸ¥</text>
    <view class="header-actions">
      <button class="refresh-btn" bindtap="refreshCheck">ğŸ”„ é‡æ–°æ£€æŸ¥</button>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading">
    <text class="loading-text">æ­£åœ¨æ£€æŸ¥ä¹¦æ¶...</text>
  </view>

  <!-- ç»“æœæ˜¾ç¤º -->
  <view wx:else class="results">
    <!-- é‡å¤ä¹¦ç±ç»Ÿè®¡ -->
    <view wx:if="{{duplicates.length > 0}}" class="duplicates-section">
      <view class="section-header">
        <text class="section-title">âš ï¸ å‘ç°é‡å¤ä¹¦ç±</text>
        <text class="count-badge">{{duplicates.length}} ç§</text>
      </view>

      <view class="summary">
        <text class="summary-text">å‘ç° {{duplicates.length}} ç§é‡å¤ä¹¦ç±</text>
        <button class="cleanup-btn" bindtap="cleanupDuplicates">ğŸ§¹ ä¸€é”®æ¸…ç†</button>
      </view>

      <view class="duplicate-list">
        <view wx:for="{{duplicates}}" wx:key="title" class="duplicate-item">
          <view class="book-header">
            <text class="book-title">{{item.title}}</text>
            <text class="book-count">{{item.count}}æœ¬</text>
          </view>

          <view class="book-details">
            <view wx:for="{{item.books}}" wx:key="_id" class="book-info">
              <view class="info-row">
                <text class="label">ID:</text>
                <text class="value">{{item._id}}</text>
              </view>
              <view class="info-row">
                <text class="label">ä¸Šä¼ æ—¶é—´:</text>
                <text class="value">{{formatTime(item.uploadTime)}}</text>
              </view>
              <view class="info-row">
                <text class="label">å­—æ•°:</text>
                <text class="value">{{item.totalChars}}</text>
              </view>
              <view class="info-row">
                <text class="label">çŠ¶æ€:</text>
                <text class="status {{item.totalChars > 0 ? 'readable' : 'unreadable'}}">{{item.totalChars > 0 ? 'å¯è¯»' : 'ä¸å¯è¯»'}}</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- æ— é‡å¤æç¤º -->
    <view wx:else class="no-duplicates">
      <text class="no-duplicates-text">âœ… ä¹¦æ¶ä¸­æ²¡æœ‰é‡å¤ä¹¦ç±</text>
    </view>

    <!-- æ‰€æœ‰ä¹¦ç±åˆ—è¡¨ -->
    <view class="all-books-section">
      <view class="section-header">
        <text class="section-title">ğŸ“š ä¹¦æ¶ä¸­çš„æ‰€æœ‰ä¹¦ç±</text>
        <text class="count-badge">{{bookList.length}} æœ¬</text>
      </view>

      <view class="book-list">
        <view wx:for="{{bookList}}" wx:key="id" class="book-item">
          <view class="book-info">
            <text class="book-name">{{item.name}}</text>
            <text class="book-meta">{{item.author}} Â· {{item.totalChars}}å­— Â· {{item.uploadTime}}</text>
            <text class="book-status {{item.hasContent === 'å¯è¯»' ? 'readable' : 'unreadable'}}">{{item.hasContent}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>