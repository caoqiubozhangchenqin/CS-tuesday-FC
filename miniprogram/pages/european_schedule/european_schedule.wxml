<!-- pages/european_schedule/european_schedule.wxml -->
<bg src="{{bgImageUrl}}" overlayOpacity="0.4" blur="0" sizeMode="cover" repeat="false" />

<view class="container">
  <!-- æ ‡é¢˜åŒºåŸŸ -->
  <view class="header">
    <text class="title">ğŸŒ æ¬§æ´²äº”å¤§è”èµ›èµ›ç¨‹</text>
    <text class="subtitle">æœ¬æœˆèµ›ç¨‹ - {{currentMonth}}</text>
  </view>

  <!-- è”èµ›åˆ‡æ¢æ ‡ç­¾ -->
  <view class="league-tabs">
    <view 
      class="tab-item {{currentLeague === 'PL' ? 'active pl' : ''}}" 
      bindtap="switchLeague" 
      data-league="PL"
    >
      <text class="tab-text">è‹±è¶…</text>
    </view>
    <view 
      class="tab-item {{currentLeague === 'PD' ? 'active pd' : ''}}" 
      bindtap="switchLeague" 
      data-league="PD"
    >
      <text class="tab-text">è¥¿ç”²</text>
    </view>
    <view 
      class="tab-item {{currentLeague === 'BL1' ? 'active bl1' : ''}}" 
      bindtap="switchLeague" 
      data-league="BL1"
    >
      <text class="tab-text">å¾·ç”²</text>
    </view>
    <view 
      class="tab-item {{currentLeague === 'FL1' ? 'active fl1' : ''}}" 
      bindtap="switchLeague" 
      data-league="FL1"
    >
      <text class="tab-text">æ³•ç”²</text>
    </view>
    <view 
      class="tab-item {{currentLeague === 'SA' ? 'active sa' : ''}}" 
      bindtap="switchLeague" 
      data-league="SA"
    >
      <text class="tab-text">æ„ç”²</text>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <loading wx:if="{{loading}}" text="âš½ æ­£åœ¨åŠ è½½{{leagueName}}èµ›ç¨‹..." mask="{{true}}"></loading>

  <!-- é”™è¯¯æç¤º -->
  <card wx:elif="{{error}}" type="danger" shadow="{{true}}">
    <text slot="content" class="error-text">âŒ {{error}}</text>
    <button slot="footer" class="retry-button" bindtap="loadMatches">é‡æ–°åŠ è½½</button>
  </card>

  <!-- èµ›ç¨‹åˆ—è¡¨ -->
  <view wx:else class="matches-container">
    <!-- æ— æ•°æ®æç¤º -->
    <empty wx:if="{{matches.length === 0}}" title="æš‚æ— èµ›ç¨‹" description="æœ¬æœˆæš‚æ— {{leagueName}}èµ›ç¨‹æ•°æ®" icon="ğŸ“…"></empty>

    <!-- æ¯”èµ›åˆ—è¡¨ -->
    <view wx:for="{{matches}}" wx:key="id" class="match-card">
      <!-- æ¯”èµ›çŠ¶æ€æ ‡ç­¾ -->
      <view class="match-status {{item.status}}">
        <text>{{item.statusText}}</text>
      </view>

      <!-- æ¯”èµ›æ—¥æœŸæ—¶é—´ -->
      <view class="match-datetime">
        <text class="date-icon">ğŸ“…</text>
        <text class="date-text">{{item.dateText}}</text>
        <text class="time-text">{{item.timeText}}</text>
      </view>

      <!-- æ¯”èµ›å¯¹é˜µ -->
      <view class="match-teams">
        <!-- ä¸»é˜Ÿ -->
        <view class="team home-team {{item.homeWin ? 'winner' : ''}}">
          <image 
            wx:if="{{item.homeTeam.crest}}" 
            class="team-crest" 
            src="{{item.homeTeam.crest}}" 
            mode="aspectFit"
          />
          <text class="team-name">{{item.homeTeam.shortName || item.homeTeam.name}}</text>
          <text wx:if="{{item.homeWin}}" class="win-badge">âœ“</text>
        </view>

        <!-- æ¯”åˆ†/VS/å¼€èµ›æ—¶é—´ -->
        <view class="score-section">
          <view wx:if="{{item.score.fullTime.home !== null}}" class="score-display">
            <text class="score home-score {{item.homeWin ? 'winning' : ''}}">{{item.score.fullTime.home}}</text>
            <text class="score-separator">:</text>
            <text class="score away-score {{item.awayWin ? 'winning' : ''}}">{{item.score.fullTime.away}}</text>
          </view>
          <view wx:else class="vs-display">
            <text class="vs-text">VS</text>
            <text wx:if="{{item.status === 'scheduled'}}" class="match-time-display">{{item.timeText}}</text>
          </view>
        </view>

        <!-- å®¢é˜Ÿ -->
        <view class="team away-team {{item.awayWin ? 'winner' : ''}}">
          <text wx:if="{{item.awayWin}}" class="win-badge">âœ“</text>
          <text class="team-name">{{item.awayTeam.shortName || item.awayTeam.name}}</text>
          <image 
            wx:if="{{item.awayTeam.crest}}" 
            class="team-crest" 
            src="{{item.awayTeam.crest}}" 
            mode="aspectFit"
          />
        </view>
      </view>

      <!-- æ¯”èµ›è½®æ¬¡å’Œåœºåœ°ä¿¡æ¯ -->
      <view class="match-info-footer">
        <view wx:if="{{item.matchday}}" class="match-round">
          <text class="round-icon">ğŸ†</text>
          <text class="round-text">ç¬¬ {{item.matchday}} è½®</text>
        </view>
        <view wx:if="{{item.venue}}" class="match-venue">
          <text class="venue-icon">ğŸŸï¸</text>
          <text class="venue-text">{{item.venue}}</text>
        </view>
        <!-- ç›´æ’­æŒ‰é’® -->
        <view wx:if="{{item.status === 'live'}}" class="live-button-container">
          <button 
            class="live-button" 
            bindtap="goToLive" 
            data-match="{{item}}"
          >
            <text class="tv-icon">ğŸ“º</text>
            <text class="live-text">Live</text>
          </button>
        </view>
      </view>
    </view>
  </view>

  <!-- æ›´æ–°æ—¶é—´ -->
  <view wx:if="{{!loading && !error && matches.length > 0}}" class="update-time">
    <text>æ•°æ®æ›´æ–°äº: {{updateTime}}</text>
  </view>
</view>
