# 如何为页面添加背景图 - 完整示例

## 示例：为 ranking 页面添加背景图

### 第一步：修改 ranking.js

**原来的代码：**
```javascript
Page({
  data: {
    rankingList: []
  },

  onLoad: function () {
    this.getRankingList();
  },

  getRankingList: function () {
    // ... 其他代码
  }
});
```

**修改后的代码：**
```javascript
Page({
  data: {
    rankingList: [],
    globalBgUrl: ''  // ← 添加这一行
  },

  onLoad: function () {
    getApp().setPageBackground(this);  // ← 添加这一行
    this.getRankingList();
  },

  // ← 添加整个 onShow 方法
  onShow: function() {
    if (!this.data.globalBgUrl) {
      setTimeout(() => {
        const app = getApp();
        if (app.globalData.globalBackgroundImageUrl) {
          this.setData({ globalBgUrl: app.globalData.globalBackgroundImageUrl });
        }
      }, 100);
    }
  },

  getRankingList: function () {
    // ... 其他代码保持不变
  }
});
```

### 第二步：修改 ranking.wxml

**原来的代码：**
```xml
<view class="container">
  <view class="title">身价排名</view>
  <!-- ... 其他内容 -->
</view>
```

**修改后的代码：**
```xml
<!-- 全局背景图 -->
<view class="page-background" style="background-image: url({{globalBgUrl}});"></view>

<view class="container">
  <view class="title">身价排名</view>
  <!-- ... 其他内容保持不变 -->
</view>
```

---

## 通用模板

### 对于任何页面的 .js 文件：

1. 在 `data:` 里添加：
```javascript
globalBgUrl: ''
```

2. 在 `onLoad` 的第一行添加：
```javascript
getApp().setPageBackground(this);
```

3. 添加 `onShow` 方法（如果已有，就在里面添加检查）：
```javascript
onShow: function() {
  if (!this.data.globalBgUrl) {
    setTimeout(() => {
      const app = getApp();
      if (app.globalData.globalBackgroundImageUrl) {
        this.setData({ globalBgUrl: app.globalData.globalBackgroundImageUrl });
      }
    }, 100);
  }
},
```

### 对于任何页面的 .wxml 文件：

在文件最顶部添加：
```xml
<!-- 全局背景图 -->
<view class="page-background" style="background-image: url({{globalBgUrl}});"></view>
```

---

## 完整示例文件

你可以直接复制以下完整代码：

### ranking.js 完整代码
```javascript
Page({
  data: {
    rankingList: [],
    globalBgUrl: ''
  },

  onLoad: function () {
    getApp().setPageBackground(this);
    this.getRankingList();
  },

  onShow: function() {
    if (!this.data.globalBgUrl) {
      setTimeout(() => {
        const app = getApp();
        if (app.globalData.globalBackgroundImageUrl) {
          this.setData({ globalBgUrl: app.globalData.globalBackgroundImageUrl });
        }
      }, 100);
    }
  },

  getRankingList: function () {
    wx.showLoading({
      title: '加载中...',
    });
    wx.cloud.callFunction({
      name: 'getRanking',
      success: res => {
        wx.hideLoading();
        if (res.result.success) {
          this.setData({
            rankingList: res.result.data
          });
        } else {
          wx.showToast({
            title: res.result.message,
            icon: 'none'
          });
        }
      },
      fail: err => {
        wx.hideLoading();
        console.error('获取排名失败', err);
        wx.showToast({
          title: '加载失败，请重试',
          icon: 'none'
        });
      }
    });
  }
});
```

### ranking.wxml 完整代码
```xml
<!-- 全局背景图 -->
<view class="page-background" style="background-image: url({{globalBgUrl}});"></view>

<view class="container">
  <view class="title">身价排名</view>
  <view class="ranking-list">
    <block wx:for="{{rankingList}}" wx:key="openid">
      <view class="ranking-item">
        <view class="rank">{{index + 1}}</view>
        <image class="avatar" src="{{item.avatarUrl}}"></image>
        <view class="player-info">
          <view class="nickname">{{item.nickname}}</view>
          <view class="total-value">{{item.total_value}} 万欧元</view>
        </view>
      </view>
    </block>
  </view>
</view>
```

---

## 需要我帮你直接修改吗？

如果你觉得手动复制粘贴麻烦，告诉我你想先添加哪个页面，我直接帮你修改！
