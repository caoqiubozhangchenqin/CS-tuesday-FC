# 小说功能测试指南

## 🧪 测试前准备

### 1. 开发者工具设置
打开微信开发者工具，勾选以下选项：
- `详情 > 本地设置 > 不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书`
- `详情 > 本地设置 > 不校验安全域名`

### 2. 打开调试模式
- 点击右上角 `调试` 按钮
- 查看 Console 标签页，观察API请求日志

---

## 📝 完整测试流程

### 第一步：进入书架
1. 在首页，点击右侧的 📚 **小说阅读按钮**（粉黄色，位于最上方）
2. 应该进入 **我的书架** 页面
3. 首次使用会看到"书架空空如也"的提示

### 第二步：搜索小说
1. 点击右上角 **🔍 搜索小说** 按钮
2. 进入搜索页面，输入以下关键词之一测试：
   - `斗破苍穹`
   - `三体`
   - `遮天`
   - `凡人修仙传`

3. 点击 **搜索** 按钮

**预期结果**：
- 显示"搜索中..."加载动画
- 2-5秒后显示搜索结果列表
- 每条结果包含：书名、作者、简介、封面（可能为空）
- 右侧显示 **加入书架** 按钮（蓝紫色）

**如果出现问题**：
- 查看 Console 是否有错误日志
- 检查"搜索API响应"日志内容
- 如果追书神器API失败，会自动降级到笔趣阁

### 第三步：加入书架
1. 在搜索结果中，点击任意一本书的 **加入书架** 按钮
2. 应该弹出提示：**已加入书架**
3. 按钮变为 **继续阅读**（绿色）

### 第四步：返回书架
1. 点击左上角返回按钮
2. 回到书架页面
3. 应该能看到刚才添加的书籍
4. 显示书名、作者、阅读进度（"未开始阅读"）

### 第五步：开始阅读
1. 点击书架中的书籍
2. 进入阅读器页面
3. 应该显示加载动画，然后显示第一章内容

**预期结果**：
- 顶部显示书名和章节标题
- 正文内容分段显示，字体清晰
- 底部有"上一章"和"下一章"导航按钮（上一章应为灰色禁用）

**如果章节加载失败**：
- 查看 Console 的"章节列表响应"和"章节内容响应"
- 点击页面上的"重试"按钮

### 第六步：测试阅读功能

#### 6.1 章节导航
- 点击底部 **下一章** 按钮，切换到第二章
- 点击 **上一章** 按钮，返回第一章

#### 6.2 菜单操作
1. 点击屏幕中间任意位置，显示顶部栏和底部菜单
2. 再次点击，隐藏菜单

#### 6.3 字号调节
1. 点击屏幕显示菜单
2. 点击底部的 **A-** 按钮，字体变小
3. 点击 **A+** 按钮，字体变大
4. 最小14px，最大24px（超出会提示）

#### 6.4 主题切换
1. 点击底部的 **🎨 主题** 按钮
2. 循环切换4种主题：
   - 🤍 白色（默认）
   - 💚 护眼绿
   - 📜 羊皮纸
   - 🌙 夜间黑

#### 6.5 章节目录
1. 点击底部的 **📑 目录** 按钮
2. 右侧滑出章节列表抽屉
3. 当前章节会高亮显示（蓝色）
4. 点击任意章节，跳转到该章
5. 点击遮罩或关闭按钮，收起目录

#### 6.6 进度条
1. 底部有章节进度条，显示"当前章 / 总章数"
2. 拖动进度条滑块，可快速跳转章节

### 第七步：测试进度保存
1. 阅读到第5章
2. 返回书架页面（点击左上角返回）
3. 查看书籍卡片，应显示"已读至：第5章"
4. 再次点击该书籍
5. 应该从第5章继续阅读（而非第1章）

### 第八步：删除书籍
1. 在书架页面，点击书籍卡片右侧的 **✕** 按钮
2. 弹出确认对话框
3. 点击 **删除**
4. 书籍从书架移除

### 第九步：搜索历史
1. 进入搜索页面
2. 应该看到之前搜索过的关键词（最多显示10条）
3. 点击历史记录，快速搜索
4. 点击 **清空** 按钮，清除所有历史

---

## 🐛 常见问题排查

### 问题1：搜索没有结果
**可能原因**：
- 追书神器API服务不稳定
- 网络连接问题
- 关键词太生僻

**解决方案**：
1. 查看 Console 的"搜索API响应"
2. 尝试常见书名（如"斗破苍穹"）
3. 检查是否勾选"不校验合法域名"
4. 如果追书神器失败，会自动降级到笔趣阁

### 问题2：章节列表加载失败
**可能原因**：
- 追书神器书源不可用
- 笔趣阁HTML结构变化

**解决方案**：
1. 查看 Console 的"书源响应"和"章节列表响应"
2. 点击"重试"按钮
3. 尝试其他书籍

### 问题3：章节内容为空
**可能原因**：
- 章节API返回异常
- HTML解析失败

**解决方案**：
1. 查看 Console 的"章节内容响应"
2. 点击页面的"重试"按钮
3. 尝试切换其他章节

### 问题4：进度保存不生效
**排查步骤**：
1. 打开 `Storage > Storage > Storage` 标签
2. 查找 `novel_shelf` 键
3. 检查 `currentChapter` 字段是否更新

---

## 📊 测试数据示例

### 推荐测试的书籍
| 书名 | 作者 | 说明 |
|------|------|------|
| 斗破苍穹 | 天蚕土豆 | 热门，章节多，测试进度保存 |
| 三体 | 刘慈欣 | 正规出版，测试内容格式 |
| 遮天 | 辰东 | 玄幻经典，测试搜索排序 |
| 凡人修仙传 | 忘语 | 长篇，测试目录功能 |

### 本地存储数据格式
```javascript
// novel_shelf - 书架数据
[{
  "id": "book_xxx",
  "name": "斗破苍穹",
  "author": "天蚕土豆",
  "url": "5816b415b06d1d32157790b1", // bookId
  "currentChapter": 5,
  "addTime": 1700000000000
}]

// novel_search_history - 搜索历史
["斗破苍穹", "三体", "遮天"]

// novel_read_settings - 阅读设置
{
  "fontSize": 18,
  "themeClass": "theme-white"
}
```

---

## ✅ 测试检查清单

- [ ] 首页📚按钮可点击
- [ ] 书架空状态显示正常
- [ ] 搜索功能返回结果
- [ ] 加入书架成功
- [ ] 书架显示已添加的书
- [ ] 点击书籍进入阅读器
- [ ] 章节内容正常显示
- [ ] 上一章/下一章导航正常
- [ ] 字号调节生效
- [ ] 主题切换正常
- [ ] 章节目录可用
- [ ] 进度条拖动跳转正常
- [ ] 阅读进度自动保存
- [ ] 删除书籍功能正常
- [ ] 搜索历史记录保存
- [ ] 清空历史功能正常

---

## 📸 预期截图

### 1. 书架页面
- 橙粉渐变背景
- 书籍卡片（白色半透明）
- 右上角紫色搜索按钮

### 2. 搜索页面
- 紫蓝渐变背景
- 搜索框（白色，带🔍图标）
- 搜索结果卡片列表

### 3. 阅读器页面
- 干净的阅读界面
- 顶部标题栏（点击显示/隐藏）
- 底部菜单栏（点击显示/隐藏）
- 右侧章节抽屉

---

## 🚀 下一步

测试通过后：
1. 配置小程序后台域名白名单
2. 真机预览测试
3. 提交审核前确保域名配置正确
4. 准备上线！

---

**祝测试顺利！** 🎉

如遇到问题，请查看 Console 日志并反馈具体错误信息。
