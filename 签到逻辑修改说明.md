# 签到逻辑修改说明

## 修改时间
2025年11月16日

## 修改目的
将"是否评估"的逻辑从"身价 > 0"改为"身价 >= 50"，确保只有完成正式评估的用户才能使用签到和选择球队等功能。

## 修改内容

### 1. 前端页面显示逻辑修改

#### `miniprogram/pages/index/index.wxml`
- **签到按钮显示条件**：从无条件显示改为 `wx:if="{{userValue >= 50}}"`
- **已评估按钮显示条件**：从 `userValue > 0` 改为 `userValue >= 50`
- **身价信息显示条件**：从 `userValue > 0` 改为 `userValue >= 50`
- **选择球队按钮显示条件**：从 `userValue > 0` 改为 `userValue >= 50`

#### `miniprogram/pages/index/index.js`
- **checkUserStatus 函数**：
  - 将 `showSurveyButton: !(userValue > 0)` 改为 `showSurveyButton: userValue < 50`
  
- **goToTeamSignup 函数**：
  - 将 `if (!(this.data.userValue > 0))` 改为 `if (this.data.userValue < 50)`
  
- **fetchUserInfo 函数**：
  - 将 `showSurveyButton: !(userInfo.total_value > 0)` 改为 `showSurveyButton: userInfo.total_value < 50`

### 2. 云函数逻辑修改

#### `cloudfunctions/signIn/index.js`
- 在检查是否已签到之前，新增身价检查逻辑：
```javascript
// 检查用户是否已完成身价评估（身价需要 >= 50）
if (!user.total_value || user.total_value < 50) {
  return {
    success: false,
    message: '请先完成身价评估'
  };
}
```

#### `cloudfunctions/joinTeam/index.js`
- 更新身价检查逻辑：
  - 从 `!player.data[0].total_value` 改为 `!player.data[0].total_value || player.data[0].total_value < 50`

## 功能影响

### 用户体验变化
1. **未评估用户（身价 = 0）**：
   - 看不到签到按钮
   - 看不到身价信息
   - 看不到选择球队按钮
   - 只能看到"开始评估"按钮

2. **评估未达标用户（0 < 身价 < 50）**：
   - 与未评估用户相同的体验
   - 需要重新评估以达到50万欧元的最低标准

3. **已评估用户（身价 >= 50）**：
   - 可以看到并使用签到按钮
   - 可以看到身价信息
   - 可以选择或更换球队
   - "开始评估"按钮变为灰色的"已评估"状态

### 防止的问题
1. ✅ 防止未评估用户直接点击签到导致身价变为1
2. ✅ 确保只有完成正式评估的用户才能参与签到和球队选择
3. ✅ 统一了整个应用中"是否已评估"的判断标准（身价 >= 50）

## 后续建议
如果需要允许用户通过签到获得初始身价，可以考虑：
- 将签到逻辑改为：如果身价 < 50，签到后设置为50（而不是+1）
- 或者提供一个"快速评估"功能，给予用户最低50万欧元的基础身价
