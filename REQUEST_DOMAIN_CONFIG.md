# 微信小程序 request 合法域名配置指南

## 📋 需要配置的域名

五大联赛历史数据功能使用以下数据源，需要将它们添加到微信小程序的 **request 合法域名** 白名单中：

### 必须配置的域名（3个）

1. **GitHub Raw 官方源**
   ```
   https://raw.githubusercontent.com
   ```

2. **ghproxy.com 镜像**
   ```
   https://ghproxy.com
   ```

3. **mirror.ghproxy.com 镜像**
   ```
   https://mirror.ghproxy.com
   ```

## 🔧 配置步骤

### 方法一：通过微信公众平台配置（推荐）

1. **登录微信公众平台**
   - 打开 https://mp.weixin.qq.com/
   - 使用管理员微信扫码登录

2. **进入开发管理**
   - 左侧菜单选择：`开发` → `开发管理`
   - 或直接访问：https://mp.weixin.qq.com/wxamp/devprofile/get_profile

3. **配置服务器域名**
   - 找到 **开发设置** 页面
   - 滚动到 **服务器域名** 部分
   - 点击 `request合法域名` 右侧的 `修改` 按钮

4. **添加域名**
   在弹出的输入框中，每行添加一个域名：
   ```
   https://raw.githubusercontent.com
   https://ghproxy.com
   https://mirror.ghproxy.com
   ```

5. **保存配置**
   - 点击 `保存并提交` 按钮
   - 需要管理员微信扫码确认

6. **注意事项**
   - ⚠️ **每个月只能修改 5 次**，请谨慎操作
   - ⚠️ 最多可配置 **20 个域名**
   - ✅ 域名必须支持 HTTPS 协议
   - ✅ 域名需要完成 ICP 备案（GitHub 等国际域名除外）

### 方法二：开发阶段临时跳过校验

在开发调试阶段，可以临时跳过域名校验：

#### 微信开发者工具设置
1. 打开微信开发者工具
2. 点击右上角 `详情` 按钮
3. 在 `本地设置` 标签页中
4. 勾选 ✅ **不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书**

⚠️ **注意**：此方法仅适用于开发阶段，正式发布前必须完成域名配置！

## 🔍 验证配置

### 1. 检查配置是否生效
登录微信公众平台后，查看 `开发管理` → `开发设置` → `服务器域名` 中是否显示已添加的域名。

### 2. 测试数据加载
- 在微信开发者工具中
- 关闭 "不校验合法域名" 选项
- 进入 "五大联赛历史数据" 页面
- 选择任意联赛和赛季
- 如果数据正常加载，说明配置成功 ✅

### 3. 查看控制台
如果配置失败，控制台会显示类似错误：
```
request:fail url not in domain list
不在以下 request 合法域名列表中
```

## 📱 真机测试

配置完成后，需要进行真机测试：

1. **重新编译小程序**
   - 在微信开发者工具中点击 `编译`
   
2. **预览测试**
   - 点击 `预览` 按钮
   - 用手机微信扫码
   - 测试历史数据功能是否正常

3. **体验版测试**
   - 上传代码为体验版
   - 在手机上访问体验版
   - 完整测试各个联赛和赛季

## 🛡️ 安全说明

### 为什么需要配置这些域名？

微信小程序出于安全考虑，只允许与已配置的合法域名进行通信。这可以：
- 防止恶意请求
- 保护用户隐私
- 确保数据来源可信

### 数据源说明

1. **raw.githubusercontent.com**
   - OpenFootball.json 官方数据源
   - GitHub 官方域名，安全可靠
   - 可能在国内访问较慢

2. **ghproxy.com**
   - GitHub 文件加速代理
   - 提高国内访问速度
   - 作为备用数据源

3. **mirror.ghproxy.com**
   - GitHub 镜像加速服务
   - 第二备用数据源
   - 三重保障确保数据可用

## 💡 常见问题

### Q1: 配置后还是无法加载数据？
**A:** 
- 检查域名是否正确（不要多加或少加字符）
- 确认已保存并通过管理员扫码确认
- 等待 5-10 分钟让配置生效
- 重新编译小程序

### Q2: 提示"本月修改次数已用完"？
**A:** 
- 每个月只能修改 5 次
- 等待下个月重置
- 或者联系微信客服申请额外配额

### Q3: 是否需要配置其他类型的域名？
**A:** 
- **request 合法域名**：✅ 必须配置（用于 API 请求）
- **socket 合法域名**：❌ 不需要（不使用 WebSocket）
- **uploadFile 合法域名**：❌ 不需要（不上传文件到这些域名）
- **downloadFile 合法域名**：❌ 不需要（不下载文件）

### Q4: 开发阶段必须配置吗？
**A:** 
- 开发阶段可以勾选"不校验合法域名"选项
- 但正式发布前必须完成配置
- 建议尽早配置，避免上线前出现问题

### Q5: 配置会影响其他功能吗？
**A:** 
- 不会影响现有功能
- 只是新增允许访问的域名
- 其他已配置的域名不受影响

## 📞 需要帮助？

如果遇到配置问题，请检查：
1. ✅ 管理员权限是否足够
2. ✅ 域名格式是否正确
3. ✅ 是否超过每月修改次数限制
4. ✅ 小程序是否已完成备案

---

**最后更新**: 2025-01-20
**适用版本**: 微信小程序基础库 2.0+
