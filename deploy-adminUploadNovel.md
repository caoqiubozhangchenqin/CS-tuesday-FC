# 🚀 部署 adminUploadNovel 云函数

## ⚠️ 重要：必须先部署云函数才能使用！

您遇到的错误 `errCode: -504003` 说明云函数未部署或超时。

---

## 📝 部署步骤（2分钟）

### 方法一：在微信开发者工具部署（推荐）

1. **打开微信开发者工具**

2. **在左侧目录树找到：**
   ```
   cloudfunctions/
     └── adminUploadNovel/
   ```

3. **右键点击 `adminUploadNovel` 文件夹**

4. **选择："上传并部署：云端安装依赖"**
   - ✅ 注意要选"云端安装依赖"，不是"不安装依赖"

5. **等待部署完成**（约30秒-1分钟）
   - 会显示上传进度
   - 完成后会提示"上传成功"

6. **验证部署成功**
   - 点击微信开发者工具顶部"云开发"按钮
   - 进入"云函数"页面
   - 应该能看到 `adminUploadNovel` 函数
   - 状态显示"部署成功"

---

### 方法二：使用命令行部署

在项目根目录运行：

```bash
# PowerShell
cd F:\CSFC
tcb fn deploy adminUploadNovel
```

---

## 🔍 部署后检查清单

### ✅ 1. 云函数是否存在
在云开发控制台 → 云函数 → 应该看到 `adminUploadNovel`

### ✅ 2. 超时时间是否正确
- 默认：3秒（太短！）
- 已配置：60秒
- 检查方式：在云函数列表点击函数名，查看"超时时间"

### ✅ 3. 依赖是否安装
- 需要：`wx-server-sdk` ~2.6.3
- 检查方式：在云函数详情中查看"依赖"标签

---

## 🐛 常见部署错误

### 错误1：`未找到云函数`
**原因**：云函数未上传  
**解决**：按方法一重新上传

### 错误2：`依赖安装失败`
**原因**：网络问题或 package.json 错误  
**解决**：
```bash
# 手动安装依赖
cd cloudfunctions/adminUploadNovel
npm install
# 然后重新上传
```

### 错误3：`超时时间太短`
**原因**：默认3秒不够用  
**解决**：已在 config.json 中设置为60秒，重新上传即可

---

## 📊 部署成功的标志

部署成功后，在调试器控制台运行测试：

```javascript
wx.cloud.callFunction({
  name: 'adminUploadNovel',
  data: {},
  success: res => console.log('云函数存在:', res),
  fail: err => console.error('云函数不存在:', err)
})
```

**预期结果**：
- ✅ 成功：返回 `{success: false, error: '缺少必要参数', code: 'MISSING_PARAMS'}`
  - 这是正常的！说明云函数在运行，只是缺少参数
- ❌ 失败：返回 `errCode: -504003` 或 `云函数不存在`
  - 说明还没部署成功

---

## 🎯 部署后再次上传小说

1. 确认云函数部署成功
2. 打开上传页面：
   ```javascript
   wx.navigateTo({ url: '/pages/admin/upload-novel/upload-novel' })
   ```
3. 选择文件
4. 点击上传
5. 成功！🎉

---

## 📞 仍然遇到问题？

如果部署后仍然超时，请检查：

1. **云开发环境是否已开通**
   - 工具栏 → 云开发 → 如果没开通会提示开通

2. **是否选择了正确的环境**
   - 检查 `project.config.json` 中的环境ID

3. **云函数日志**
   - 云开发控制台 → 云函数 → 点击函数名 → 日志
   - 查看具体错误信息

4. **文件是否太大**
   - 建议小于 10MB
   - 大文件可能需要更长时间

---

**现在请先部署云函数，然后再试一次！** 🚀
